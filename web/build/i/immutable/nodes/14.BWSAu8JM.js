import{f as b,a as k}from"../chunks/DwaBocJP.js";import{i as Ve}from"../chunks/Cn36vQlI.js";import{o as qe}from"../chunks/CbLRd9uU.js";import{z as Ke,A as C,B as Ue,c as f,m as D,D as l,C as i,F as v,b as e,K as je,O as ze,H as h}from"../chunks/D8pH6ZKL.js";import{s as x,e as g}from"../chunks/DMOeGUlm.js";import{i as ie}from"../chunks/BXZ4KMWb.js";import{e as we,s as xe}from"../chunks/CaL8-jqQ.js";import{s as Ge,r as y}from"../chunks/CeRkQ_jF.js";import{s as ye}from"../chunks/BWrQZ7tB.js";import{b as R}from"../chunks/DmFdKuaY.js";import{b as Je}from"../chunks/CMTjv1Cc.js";import{b as Qe}from"../chunks/D8NaDAO_.js";import{s as Ze}from"../chunks/Bfc47y5P.js";import{a as T}from"../chunks/D_yn4hlI.js";import{t as I}from"../chunks/DEEbTplX.js";import{b as es}from"../chunks/DZFsq0ZI.js";var ss=b('<div class="loading svelte-1p6svkz">Loading...</div>'),ts=b('<button class="btn btn-delete svelte-1p6svkz">Delete Rack</button>'),as=b('<div><div class="name svelte-1p6svkz"> </div> <div class="meta svelte-1p6svkz"> </div></div>'),is=b('<div class="no-racks svelte-1p6svkz">No racks yet. Create one above.</div>'),vs=b('<div><div class="indicator-dot svelte-1p6svkz"></div> <div class="rack-label svelte-1p6svkz"><span class="rack-name svelte-1p6svkz"> </span> <span class="dims svelte-1p6svkz"> </span></div></div>'),ls=b('<div class="main-layout svelte-1p6svkz"><div class="sidebar svelte-1p6svkz"><h2 class="svelte-1p6svkz">Rack Management</h2> <div class="rack-form svelte-1p6svkz"><div class="form-group svelte-1p6svkz"><label class="svelte-1p6svkz">Name</label> <input type="text" placeholder="e.g. Regal A" class="svelte-1p6svkz"/></div> <div class="form-row svelte-1p6svkz"><div class="form-group svelte-1p6svkz"><label class="svelte-1p6svkz">Cols</label> <input type="number" min="1" placeholder="5" class="svelte-1p6svkz"/></div> <div class="form-group svelte-1p6svkz"><label class="svelte-1p6svkz">Rows</label> <input type="number" min="1" placeholder="10" class="svelte-1p6svkz"/></div></div> <div class="form-group svelte-1p6svkz"><label class="svelte-1p6svkz">Start ID</label> <input type="number" placeholder="Auto" class="svelte-1p6svkz"/></div> <div class="form-row svelte-1p6svkz"><div class="form-group svelte-1p6svkz"><label class="svelte-1p6svkz">Width (px)</label> <input type="number" placeholder="Auto" class="svelte-1p6svkz"/></div> <div class="form-group svelte-1p6svkz"><label class="svelte-1p6svkz">Height (px)</label> <input type="number" placeholder="Auto" class="svelte-1p6svkz"/></div></div> <div class="form-group svelte-1p6svkz"><label class="svelte-1p6svkz">Rotation</label> <select class="svelte-1p6svkz"><option>0 (Horizontal)</option><option>90 (Vertical)</option><option>180 (Inverted)</option><option>270 (Vert. Inverted)</option></select></div> <div class="form-row svelte-1p6svkz"><button class="btn btn-primary svelte-1p6svkz"> </button> <button class="btn btn-secondary svelte-1p6svkz">Clear</button></div> <!></div> <div class="racks-list svelte-1p6svkz"><!> <!></div></div>  <div class="canvas-area svelte-1p6svkz"><div class="canvas-container svelte-1p6svkz"></div></div></div>'),os=b('<div class="blueprint-page svelte-1p6svkz"><header class="svelte-1p6svkz"><a class="back-link svelte-1p6svkz">Home</a> <h1 class="svelte-1p6svkz">Warehouse Blueprint</h1> <div class="rack-count svelte-1p6svkz"> </div></header> <!></div>');function ys(Re,Ie){Ke(Ie,!1);let p=D([]),c=D(null),ve=D(!0),t=D({name:"",columns:1,rows:1,startIndex:"",visualWidth:0,visualHeight:0,rotation:0}),A=!1,z=null,L={x:0,y:0},$=D();qe(async()=>{await N(),f(ve,!1)});async function N(){try{f(p,await T.get("/api/warehouse/racks"))}catch{I.add("Failed to load racks","error")}}function P(s){f(c,s),f(t,{name:s.name||"",columns:s.columns||1,rows:s.rows||1,startIndex:s.startIndex||"",visualWidth:s.visualWidth||0,visualHeight:s.visualHeight||0,rotation:s.rotation||0})}function M(){f(c,null),f(t,{name:"",columns:1,rows:1,startIndex:"",visualWidth:0,visualHeight:0,rotation:0})}async function $e(){var r,n,d;if(!e(t).name||!e(t).columns||!e(t).rows){I.add("Please fill Name, Cols, and Rows","error");return}const s={id:((r=e(c))==null?void 0:r.id)||null,name:e(t).name,columns:parseInt(e(t).columns),rows:parseInt(e(t).rows),startIndex:e(t).startIndex===""?-1:parseInt(e(t).startIndex),visualWidth:parseInt(e(t).visualWidth)||0,visualHeight:parseInt(e(t).visualHeight)||0,rotation:parseInt(e(t).rotation)||0,posX:((n=e(c))==null?void 0:n.posX)||0,posY:((d=e(c))==null?void 0:d.posY)||0};try{await T.post("/api/warehouse/racks",s),I.add("Rack saved!","success"),e(c)||M(),await N()}catch{I.add("Failed to save rack","error")}}async function He(){if(!(!e(c)||!confirm("Delete this rack?")))try{await T.delete(`/api/warehouse/racks/${e(c).id}`),M(),await N(),I.add("Rack deleted","success")}catch{I.add("Failed to delete rack","error")}}function We(s,r){A=!0,z=r,P(r);const d=s.currentTarget.getBoundingClientRect();L.x=s.clientX-d.left,L.y=s.clientY-d.top,window.addEventListener("mousemove",le),window.addEventListener("mouseup",oe)}function le(s){if(!A||!z||!e($))return;const r=e($).getBoundingClientRect();let n=s.clientX-r.left-L.x,d=s.clientY-r.top-L.y;n=Math.round(n/10)*10,d=Math.round(d/10)*10,n=Math.max(0,n),d=Math.max(0,d);const m=e(p).findIndex(X=>X.id===z.id);m!==-1&&(h(p,e(p)[m]={...e(p)[m],posX:n,posY:d}),f(p,e(p)))}async function oe(){if(A&&z){const s=e(p).find(r=>r.id===z.id);if(s)try{await T.post("/api/warehouse/racks",s)}catch(r){console.error("Auto-save position failed",r)}}A=!1,z=null,window.removeEventListener("mousemove",le),window.removeEventListener("mouseup",oe)}function Ce(s){let r=s.visualWidth>0?s.visualWidth:s.columns*50,n=s.visualHeight>0?s.visualHeight:s.rows*50;return{w:r,h:n}}function De(s){const r=s||0;return(r===90||r===270?90:0)-r}function Ae(s){(s.target===e($)||s.target.classList.contains("canvas-container"))&&M()}function Le(s){return s.columns*s.rows}Ve();var O=os(),V=l(O),re=l(V),ne=i(re,4),Me=l(ne);v(ne),v(V);var Xe=i(V,2);{var Ye=s=>{var r=ss();k(s,r)},Ee=s=>{var r=ls(),n=l(r),d=i(l(n),2),m=l(d),X=i(l(m),2);y(X),v(m);var q=i(m,2),K=l(q),de=i(l(K),2);y(de),v(K);var pe=i(K,2),ce=i(l(pe),2);y(ce),v(pe),v(q);var U=i(q,2),ue=i(l(U),2);y(ue),v(U);var j=i(U,2),G=l(j),me=i(l(G),2);y(me),v(G);var _e=i(G,2),fe=i(l(_e),2);y(fe),v(_e),v(j);var J=i(j,2),Q=i(l(J),2);C(()=>{e(t),je(()=>{})});var Z=l(Q);Z.value=Z.__value=0;var ee=i(Z);ee.value=ee.__value=90;var se=i(ee);se.value=se.__value=180;var he=i(se);he.value=he.__value=270,v(Q),v(J);var te=i(J,2),Y=l(te),Fe=l(Y);v(Y);var Be=i(Y,2);v(te);var Se=i(te,2);{var Te=a=>{var o=ts();g("click",o,He),k(a,o)};ie(Se,a=>{e(c)&&a(Te)})}v(d);var ke=i(d,2),ge=l(ke);we(ge,1,()=>e(p),a=>a.id,(a,o)=>{var _=as();let F;var u=l(_),B=l(u,!0);v(u);var w=i(u,2),H=l(w);v(w),v(_),C(ae=>{var W;F=xe(_,1,"rack-item svelte-1p6svkz",null,F,{active:((W=e(c))==null?void 0:W.id)===e(o).id}),x(B,e(o).name||`Rack #${e(o).id}`),x(H,`${e(o).columns??""}x${e(o).rows??""} = ${ae??""} places | Start: ${e(o).startIndex??""}`)},[()=>Le(e(o))]),g("click",_,()=>P(e(o))),k(a,_)});var Ne=i(ge,2);{var Pe=a=>{var o=is();k(a,o)};ie(Ne,a=>{e(p).length===0&&a(Pe)})}v(ke),v(n);var E=i(n,2),be=l(E);we(be,5,()=>e(p),a=>a.id,(a,o)=>{const _=ze(()=>Ce(e(o))),F=ze(()=>De(e(o).rotation));var u=vs();let B;var w=i(l(u),2),H=l(w),ae=l(H,!0);v(H);var W=i(H,2),Oe=l(W);v(W),v(w),v(u),C(()=>{var S;B=xe(u,1,"rack-node svelte-1p6svkz",null,B,{selected:((S=e(c))==null?void 0:S.id)===e(o).id}),ye(u,`
                                left: ${(e(o).posX||0)??""}px;
                                top: ${(e(o).posY||0)??""}px;
                                width: ${e(_).w??""}px;
                                height: ${e(_).h??""}px;
                                transform: rotate(${(e(o).rotation||0)??""}deg);
                            `),ye(w,`transform: rotate(${e(F)??""}deg);`),x(ae,e(o).name||`#${e(o).id}`),x(Oe,`${e(o).columns??""}x${e(o).rows??""}`)}),g("mousedown",u,S=>We(S,e(o))),g("click",u,Ze(()=>P(e(o)))),k(a,u)}),v(be),v(E),Qe(E,a=>f($,a),()=>e($)),v(r),C(()=>x(Fe,`${e(c)?"Update":"Create"} Rack`)),R(X,()=>e(t).name,a=>h(t,e(t).name=a)),R(de,()=>e(t).columns,a=>h(t,e(t).columns=a)),R(ce,()=>e(t).rows,a=>h(t,e(t).rows=a)),R(ue,()=>e(t).startIndex,a=>h(t,e(t).startIndex=a)),R(me,()=>e(t).visualWidth,a=>h(t,e(t).visualWidth=a)),R(fe,()=>e(t).visualHeight,a=>h(t,e(t).visualHeight=a)),Je(Q,()=>e(t).rotation,a=>h(t,e(t).rotation=a)),g("click",Y,$e),g("click",Be,M),g("click",E,Ae),k(s,r)};ie(Xe,s=>{e(ve)?s(Ye):s(Ee,!1)})}v(O),C(()=>{Ge(re,"href",`${es??""}/dashboard/warehouse`),x(Me,`${e(p).length??""} rack${e(p).length!==1?"s":""}`)}),k(Re,O),Ue()}export{ys as component};
