import{f as b,a as n,c as Ee,t as Pe}from"../chunks/DwaBocJP.js";import{i as Le}from"../chunks/Cn36vQlI.js";import{o as Ne}from"../chunks/CbLRd9uU.js";import{z as Se,G as ce,B as Fe,C as l,D as s,c as o,m as G,F as t,b as e,A as X,K as Me,E as je,H as E}from"../chunks/D8pH6ZKL.js";import{e as p,s as _}from"../chunks/DMOeGUlm.js";import{i as H}from"../chunks/BXZ4KMWb.js";import{e as qe,s as de,i as Ie}from"../chunks/CaL8-jqQ.js";import{r as j,s as oe}from"../chunks/CeRkQ_jF.js";import{b as J,a as Re}from"../chunks/DmFdKuaY.js";import{b as ze}from"../chunks/CMTjv1Cc.js";import{s as Be}from"../chunks/Bfc47y5P.js";import{b as Ge}from"../chunks/6Fc_rrnG.js";import{a as K}from"../chunks/D_yn4hlI.js";import{t as f}from"../chunks/DEEbTplX.js";var He=b('<div class="loading svelte-1m3dwdc">Loading users...</div>'),Je=b('<div class="empty svelte-1m3dwdc">No users found. Create one to get started.</div>'),Ke=b('<span class="pin-set svelte-1m3dwdc">&#x2713; Set</span>'),Oe=b('<span class="pin-none svelte-1m3dwdc">-</span>'),Qe=b('<span class="muted svelte-1m3dwdc">never</span>'),Te=b('<tr><td class="svelte-1m3dwdc"><button title="Click to toggle"> </button></td><td class="name-cell svelte-1m3dwdc"> </td><td class="svelte-1m3dwdc"><div class="username svelte-1m3dwdc"> </div> <div class="email svelte-1m3dwdc"> </div></td><td class="svelte-1m3dwdc"><span> </span></td><td class="svelte-1m3dwdc"><!></td><td class="date-cell svelte-1m3dwdc"><!></td><td class="actions-cell svelte-1m3dwdc"><button class="btn-icon svelte-1m3dwdc" title="Edit">&#9998;</button> <button class="btn-icon delete svelte-1m3dwdc" title="Delete">&#128465;</button></td></tr>'),Ve=b('<div class="table-container svelte-1m3dwdc"><table class="svelte-1m3dwdc"><thead><tr><th class="svelte-1m3dwdc">Status</th><th class="svelte-1m3dwdc">Name</th><th class="svelte-1m3dwdc">Username / Email</th><th class="svelte-1m3dwdc">Role</th><th class="svelte-1m3dwdc">PIN</th><th class="svelte-1m3dwdc">Last Login</th><th class="svelte-1m3dwdc">Actions</th></tr></thead><tbody></tbody></table></div>'),We=b('<div class="modal-backdrop svelte-1m3dwdc"><div class="modal svelte-1m3dwdc"><h2 class="svelte-1m3dwdc"> </h2> <div class="form-row svelte-1m3dwdc"><div class="form-group svelte-1m3dwdc"><label for="username" class="svelte-1m3dwdc">Username</label> <input id="username" type="text" placeholder="jdoe" class="svelte-1m3dwdc"/></div> <div class="form-group svelte-1m3dwdc"><label for="email" class="svelte-1m3dwdc">Email</label> <input id="email" type="email" placeholder="john@example.com" class="svelte-1m3dwdc"/></div></div> <div class="form-group svelte-1m3dwdc"><label for="name" class="svelte-1m3dwdc">Full Name</label> <input id="name" type="text" placeholder="John Doe" class="svelte-1m3dwdc"/></div> <div class="form-row svelte-1m3dwdc"><div class="form-group svelte-1m3dwdc"><label for="role" class="svelte-1m3dwdc">Role</label> <select id="role" class="svelte-1m3dwdc"><option>User</option><option>Admin</option><option>Device</option></select></div> <div class="form-group svelte-1m3dwdc"><label for="pin" class="svelte-1m3dwdc">PDA PIN (4 digits)</label> <input id="pin" type="text" maxlength="4" pattern="[0-9]*" inputmode="numeric" class="svelte-1m3dwdc"/></div></div> <div class="form-group svelte-1m3dwdc"><label for="password" class="svelte-1m3dwdc"> </label> <input id="password" type="password" class="svelte-1m3dwdc"/></div> <div class="form-check svelte-1m3dwdc"><input type="checkbox" id="active"/> <label for="active" class="svelte-1m3dwdc">Account Active</label></div> <div class="modal-actions svelte-1m3dwdc"><button class="btn secondary svelte-1m3dwdc">Cancel</button> <button class="btn primary svelte-1m3dwdc"> </button></div></div></div>'),Xe=b('<div class="page svelte-1m3dwdc"><header class="svelte-1m3dwdc"><h1 class="svelte-1m3dwdc">User Management</h1> <button class="btn primary svelte-1m3dwdc">+ Add User</button></header> <!></div> <!>',1);function na(ne,le){Se(le,!1);let Y=G([]),Z=G(!0),P=G(!1),u=G(!1),d=G({id:"",username:"",email:"",name:"",role:"user",password:"",pin:"",isActive:!0});Ne(()=>{O()});async function O(){o(Z,!0);try{o(Y,await K.get("/api/admin/users")||[])}catch(a){f.add("Failed to load users: "+a.message,"error")}finally{o(Z,!1)}}function me(){o(d,{id:"",username:"",email:"",name:"",role:"user",password:"",pin:"",isActive:!0}),o(u,!1),o(P,!0)}function pe(a){o(d,{id:a.id,username:a.username,email:a.email,name:a.name||"",role:a.role,password:"",pin:"",isActive:a.isActive}),o(u,!0),o(P,!0)}async function ue(){try{if(e(u)){const a={...e(d)};a.password||delete a.password,a.pin||delete a.pin,await K.put(`/api/admin/users/${e(d).id}`,a),f.add("User updated","success")}else{if(!e(d).username||!e(d).email||!e(d).password){f.add("Username, email and password are required","error");return}await K.post("/api/admin/users",e(d)),f.add("User created","success")}o(P,!1),O()}catch(a){f.add(a.message,"error")}}async function we(a,v){if(confirm(`Delete user "${v}"?`))try{await K.delete(`/api/admin/users/${a}`),f.add("User deleted","success"),O()}catch(h){f.add(h.message,"error")}}async function _e(a){try{await K.put(`/api/admin/users/${a.id}`,{isActive:!a.isActive}),f.add(`User ${a.isActive?"disabled":"enabled"}`,"success"),O()}catch(v){f.add(v.message,"error")}}Le();var ie=Xe(),$=ce(ie),ee=s($),fe=l(s(ee),2);t(ee);var be=l(ee,2);{var he=a=>{var v=He();n(a,v)},ge=a=>{var v=Ee(),h=ce(v);{var q=m=>{var w=Je();n(m,w)},ae=m=>{var w=Ve(),L=s(w),I=l(s(L));qe(I,5,()=>e(Y),Ie,(Q,i)=>{var k=Te();let N;var x=s(k),g=s(x),R=s(g,!0);t(g),t(x);var A=l(x),T=s(A,!0);t(A);var S=l(A),U=s(S),z=s(U,!0);t(U);var F=l(U,2),te=s(F,!0);t(F),t(S);var D=l(S),C=s(D),V=s(C,!0);t(C),t(D);var M=l(D),W=s(M);{var B=c=>{var y=Ke();n(c,y)},se=c=>{var y=Oe();n(c,y)};H(W,c=>{e(i).hasPin?c(B):c(se,!1)})}t(M);var r=l(M),xe=s(r);{var Ae=c=>{var y=Pe();X(Ce=>_(y,Ce),[()=>new Date(e(i).lastLogin).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"2-digit"})]),n(c,y)},Ue=c=>{var y=Qe();n(c,y)};H(xe,c=>{e(i).lastLogin?c(Ae):c(Ue,!1)})}t(r);var re=l(r),ve=s(re),De=l(ve,2);t(re),t(k),X(()=>{N=de(k,1,"svelte-1m3dwdc",null,N,{disabled:!e(i).isActive}),de(g,1,`badge ${e(i).isActive?"active":"inactive"}`,"svelte-1m3dwdc"),_(R,e(i).isActive?"Active":"Disabled"),_(T,e(i).name||"-"),_(z,e(i).username),_(te,e(i).email),de(C,1,`role-badge ${e(i).role??""}`,"svelte-1m3dwdc"),_(V,e(i).role)}),p("click",g,()=>_e(e(i))),p("click",ve,()=>pe(e(i))),p("click",De,()=>we(e(i).id,e(i).username)),n(Q,k)}),t(I),t(L),t(w),n(m,w)};H(h,m=>{e(Y).length===0?m(q):m(ae,!1)},!0)}n(a,v)};H(be,a=>{e(Z)?a(he):a(ge,!1)})}t($);var ye=l($,2);{var ke=a=>{var v=We(),h=s(v),q=s(h),ae=s(q,!0);t(q);var m=l(q,2),w=s(m),L=l(s(w),2);j(L),t(w);var I=l(w,2),Q=l(s(I),2);j(Q),t(I),t(m);var i=l(m,2),k=l(s(i),2);j(k),t(i);var N=l(i,2),x=s(N),g=l(s(x),2);X(()=>{e(d),Me(()=>{})});var R=s(g);R.value=R.__value="user";var A=l(R);A.value=A.__value="admin";var T=l(A);T.value=T.__value="device",t(g),t(x);var S=l(x,2),U=l(s(S),2);j(U),t(S),t(N);var z=l(N,2),F=s(z),te=s(F,!0);t(F);var D=l(F,2);j(D),t(z);var C=l(z,2),V=s(C);j(V),je(2),t(C);var M=l(C,2),W=s(M),B=l(W,2),se=s(B,!0);t(B),t(M),t(h),t(v),X(()=>{_(ae,e(u)?"Edit User":"Create User"),L.disabled=e(u),oe(U,"placeholder",e(u)?"blank = keep":"1234"),_(te,e(u)?"New Password (blank to keep)":"Password"),oe(D,"placeholder",e(u)?"blank = keep current":"required"),_(se,e(u)?"Save Changes":"Create User")}),J(L,()=>e(d).username,r=>E(d,e(d).username=r)),J(Q,()=>e(d).email,r=>E(d,e(d).email=r)),J(k,()=>e(d).name,r=>E(d,e(d).name=r)),ze(g,()=>e(d).role,r=>E(d,e(d).role=r)),J(U,()=>e(d).pin,r=>E(d,e(d).pin=r)),J(D,()=>e(d).password,r=>E(d,e(d).password=r)),Re(V,()=>e(d).isActive,r=>E(d,e(d).isActive=r)),p("click",W,()=>o(P,!1)),p("click",B,ue),p("click",h,Be(function(r){Ge.call(this,le,r)})),p("keydown",h,()=>{}),p("click",v,()=>o(P,!1)),p("keydown",v,()=>{}),n(a,v)};H(ye,a=>{e(P)&&a(ke)})}p("click",fe,me),n(ne,ie),Fe()}export{na as component};
