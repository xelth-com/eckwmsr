import{f as D,a as M,c as he}from"../chunks/DwaBocJP.js";import{i as de}from"../chunks/Cn36vQlI.js";import{o as ye,a as xe}from"../chunks/CbLRd9uU.js";import{au as Fe,Z as Me,b8 as Le,av as Be,e as Pe,u as ce,b9 as Ue,ba as De,bb as je,aP as Ne,bc as qe,q as ze,n as G,w as Je,z as ue,B as ve,F as x,D as N,A as fe,b as k,m as _e,c as ne,G as be,C as w,I as Ge,J as Ke}from"../chunks/D8pH6ZKL.js";import{a as Ve,s as V,e as Ee}from"../chunks/DMOeGUlm.js";import{s as Ze}from"../chunks/BoDfCckp.js";import{s as P}from"../chunks/CeRkQ_jF.js";import{e as Ce,s as O,i as He}from"../chunks/CaL8-jqQ.js";import{s as Te,a as ae}from"../chunks/wVSw00Z_.js";import{a as oe}from"../chunks/DOjvBrX7.js";import{t as F}from"../chunks/DEEbTplX.js";import{i as me}from"../chunks/BXZ4KMWb.js";import{b as y}from"../chunks/DZFsq0ZI.js";import{g as K}from"../chunks/D11uLj64.js";import{p as Qe}from"../chunks/_DTFJL5n.js";const Xe=()=>performance.now(),L={tick:t=>requestAnimationFrame(t),now:()=>Xe(),tasks:new Set};function ke(){const t=L.now();L.tasks.forEach(e=>{e.c(t)||(L.tasks.delete(e),e.f())}),L.tasks.size!==0&&L.tick(ke)}function Ye(t){let e;return L.tasks.size===0&&L.tick(ke),{promise:new Promise(r=>{L.tasks.add(e={c:t,f:r})}),abort(){L.tasks.delete(e)}}}function ee(t,e){Ne(()=>{t.dispatchEvent(new CustomEvent(e))})}function ea(t){if(t==="float")return"cssFloat";if(t==="offset")return"cssOffset";if(t.startsWith("--"))return t;const e=t.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(r=>r[0].toUpperCase()+r.slice(1)).join("")}function ge(t){const e={},r=t.split(";");for(const s of r){const[o,l]=s.split(":");if(!o||l===void 0)break;const d=ea(o.trim());e[d]=l.trim()}return e}const aa=t=>t;function $e(t,e,r,s){var C;var o=(t&De)!==0,l=(t&je)!==0,d=o&&l,b=(t&Ue)!==0,u=d?"both":o?"in":"out",p,v=e.inert,S=e.style.overflow,a,n;function m(){return Ne(()=>p??(p=r()(e,(s==null?void 0:s())??{},{direction:u})))}var c={is_global:b,in(){var $;if(e.inert=v,!o){n==null||n.abort(),($=n==null?void 0:n.reset)==null||$.call(n);return}l||a==null||a.abort(),ee(e,"introstart"),a=le(e,m(),n,1,()=>{ee(e,"introend"),a==null||a.abort(),a=p=void 0,e.style.overflow=S})},out($){if(!l){$==null||$(),p=void 0;return}e.inert=!0,ee(e,"outrostart"),n=le(e,m(),a,0,()=>{ee(e,"outroend"),$==null||$()})},stop:()=>{a==null||a.abort(),n==null||n.abort()}},i=Fe;if(((C=i.nodes).t??(C.t=[])).push(c),o&&Ve){var f=b;if(!f){for(var h=i.parent;h&&(h.f&Me)!==0;)for(;(h=h.parent)&&(h.f&Le)===0;);f=!h||(h.f&Be)!==0}f&&Pe(()=>{ce(()=>c.in())})}}function le(t,e,r,s,o){var l=s===1;if(qe(e)){var d,b=!1;return ze(()=>{if(!b){var i=e({direction:l?"in":"out"});d=le(t,i,r,s,o)}}),{abort:()=>{b=!0,d==null||d.abort()},deactivate:()=>d.deactivate(),reset:()=>d.reset(),t:()=>d.t()}}if(r==null||r.deactivate(),!(e!=null&&e.duration))return o(),{abort:G,deactivate:G,reset:G,t:()=>s};const{delay:u=0,css:p,tick:v,easing:S=aa}=e;var a=[];if(l&&r===void 0&&(v&&v(0,1),p)){var n=ge(p(0,1));a.push(n,n)}var m=()=>1-s,c=t.animate(a,{duration:u,fill:"forwards"});return c.onfinish=()=>{c.cancel();var i=(r==null?void 0:r.t())??1-s;r==null||r.abort();var f=s-i,h=e.duration*Math.abs(f),C=[];if(h>0){var $=!1;if(p)for(var E=Math.ceil(h/16.666666666666668),T=0;T<=E;T+=1){var I=i+f*S(T/E),W=ge(p(I,1-I));C.push(W),$||($=W.overflow==="hidden")}$&&(t.style.overflow="hidden"),m=()=>{var A=c.currentTime;return i+f*S(A/h)},v&&Ye(()=>{if(c.playState!=="running")return!1;var A=m();return v(A,1-A),!0})}c=t.animate(C,{duration:h,fill:"forwards"}),c.onfinish=()=>{m=()=>s,v==null||v(s,1-s),o()}},{abort:()=>{c&&(c.cancel(),c.effect=null,c.onfinish=G)},deactivate:()=>{o=G},reset:()=>{s===0&&(v==null||v(1,0))},t:()=>m()}}const sa=3e3;function ta(){const{subscribe:t,set:e,update:r}=Je({connected:!1,lastMessage:null,error:null});let s,o,l=!1;function d(){if(s&&(s.readyState===WebSocket.CONNECTING||s.readyState===WebSocket.OPEN))return;const p=window.location.protocol==="https:"?"wss:":"ws:",v=window.location.host,S=`${p}//${v}/E/ws`;console.log(`[WS] Connecting to ${S}...`),s=new WebSocket(S),s.onopen=()=>{console.log("[WS] Connected"),r(a=>({...a,connected:!0,error:null}))},s.onclose=()=>{console.log("[WS] Disconnected"),r(a=>({...a,connected:!1})),l||(clearTimeout(o),o=setTimeout(d,sa))},s.onerror=a=>{console.error("[WS] Connection Error",a),r(n=>({...n,error:"Connection error"}))},s.onmessage=a=>{try{const n=JSON.parse(a.data);n._receivedAt=Date.now(),r(m=>({...m,lastMessage:n}))}catch(n){console.error("[WS] Failed to parse message",n)}}}function b(){l=!0,s&&s.close()}function u(p){s&&s.readyState===WebSocket.OPEN?s.send(JSON.stringify(p)):console.warn("[WS] Cannot send, not connected")}return{subscribe:t,connect:d,close:b,send:u}}const ie=ta();function ra(t){const e=t-1;return e*e*e+1}function we(t){const e=typeof t=="string"&&t.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return e?[parseFloat(e[1]),e[2]||"px"]:[t,"px"]}function Se(t,{delay:e=0,duration:r=400,easing:s=ra,x:o=0,y:l=0,opacity:d=0}={}){const b=getComputedStyle(t),u=+b.opacity,p=b.transform==="none"?"":b.transform,v=u*(1-d),[S,a]=we(o),[n,m]=we(l);return{delay:e,duration:r,easing:s,css:(c,i)=>`
			transform: ${p} translate(${(1-c)*S}${a}, ${(1-c)*n}${m});
			opacity: ${u-v*i}`}}var na=D('<div role="alert"> </div>'),oa=D('<div class="toast-container svelte-cqwvc2"></div>');function ia(t,e){ue(e,!1);const r=()=>ae(F,"$toastStore",s),[s,o]=Te();de();var l=oa();Ce(l,5,r,d=>d.id,(d,b)=>{var u=na(),p=N(u,!0);x(u),fe(()=>{O(u,1,`toast ${k(b).type??""}`,"svelte-cqwvc2"),V(p,k(b).message)}),$e(1,u,()=>Se,()=>({y:20,duration:300})),$e(2,u,()=>Se,()=>({x:20,duration:300})),Ee("click",u,()=>F.remove(k(b).id)),M(d,u)}),x(l),M(t,l),ve(),o()}var ca=D('<div class="mesh-node loading svelte-10x5b0t"><span class="node-icon svelte-10x5b0t">‚è≥</span> <span class="node-label svelte-10x5b0t">Loading...</span></div>'),la=D('<div class="mesh-node offline svelte-10x5b0t"><span class="node-icon svelte-10x5b0t">‚ö†Ô∏è</span> <span class="node-label svelte-10x5b0t">No nodes</span></div>'),da=D('<div><span class="node-icon svelte-10x5b0t"> </span> <span class="node-label svelte-10x5b0t"> </span> <span></span></div>'),ua=D('<div class="mesh-status svelte-10x5b0t"><!></div>');function va(t,e){ue(e,!1);let r=_e([]),s=_e(!0),o;async function l(){try{const a=await fetch(`${y}/mesh/nodes`);a.ok&&(ne(r,await a.json()),ne(s,!1))}catch(a){console.error("Failed to fetch mesh nodes:",a),ne(s,!1)}}ye(()=>{l(),o=setInterval(l,3e4)}),xe(()=>{o&&clearInterval(o)});function d(a){switch(a){case"master":return"üåê";case"peer":return"üñ•Ô∏è";case"edge":return"üì±";default:return"üîó"}}function b(a){const n=a.instance_id,m=a.role.toUpperCase();let c="";if(a.base_url&&!a.base_url.includes("localhost"))try{c=new URL(a.base_url).hostname}catch{}if(!c){let i=n;if(i=i.replace(/^production_/,""),i=i.replace(/^local_/,""),i=i.replace(/^instance_/,""),i.includes("-")){const f=i.split("-");f.length>=5&&(i=f.slice(0,2).join("-"))}i.length>20&&(i=i.substring(0,20)),c=i}return`${m}-${c}`}de();var u=ua(),p=N(u);{var v=a=>{var n=ca();M(a,n)},S=a=>{var n=he(),m=be(n);{var c=f=>{var h=la();M(f,h)},i=f=>{var h=he(),C=be(h);Ce(C,1,()=>k(r),He,($,E)=>{var T=da();let I;var W=N(T),A=N(W,!0);x(W);var j=w(W,2),q=N(j,!0);x(j);var Z=w(j,2);let z;x(T),fe((H,Q)=>{I=O(T,1,"mesh-node svelte-10x5b0t",null,I,{online:k(E).is_online,offline:!k(E).is_online}),V(A,H),V(q,Q),z=O(Z,1,"node-status svelte-10x5b0t",null,z,{online:k(E).is_online})},[()=>d(k(E).role),()=>b(k(E))]),M($,T)}),M(f,h)};me(m,f=>{k(r).length===0?f(c):f(i,!1)},!0)}M(a,n)};me(p,a=>{k(s)?a(v):a(S,!1)})}x(u),M(t,u),ve()}var fa=D('<div class="dashboard-layout svelte-2agd5u"><aside class="sidebar svelte-2agd5u"><div class="brand svelte-2agd5u"><span class="brand-text svelte-2agd5u">eckWMS</span></div> <div class="mesh-section svelte-2agd5u"><div class="section-label svelte-2agd5u">Connected Servers:</div> <!></div> <nav class="svelte-2agd5u"><a>Dashboard</a> <a>Inventory</a> <a>Warehouse</a> <a>Shipping</a> <a>RMA Requests</a> <a>Printing</a> <a>Devices</a> <a>Users</a></nav> <div class="user-panel svelte-2agd5u"><div class="user-info svelte-2agd5u"><span class="username svelte-2agd5u"> </span> <span class="role svelte-2agd5u"> </span></div> <button class="logout-btn svelte-2agd5u">Logout</button></div></aside> <main class="content svelte-2agd5u"><!></main> <!></div>');function ka(t,e){ue(e,!1);const r=()=>ae(ie,"$wsStore",l),s=()=>ae(oe,"$authStore",l),o=()=>ae(Qe,"$page",l),[l,d]=Te();ye(()=>{const _=oe.subscribe(R=>{!R.isLoading&&!R.isAuthenticated&&K(`${y||"/E"}/login`)});return ie.connect(),()=>{_()}}),xe(()=>{});function b(){oe.logout(),ie.close(),K(`${y}/login`)}function u(_){if(!(Date.now()-(_._receivedAt||0)>2e3)){if(_.barcode||_.data&&_.data.barcode){const R=_.barcode||_.data.barcode;p(R);return}_.success&&_.data?F.add("Operation Success","success"):_.type==="ERROR"||_.error?F.add(_.text||_.error||"Error occurred","error"):_.text&&F.add(_.text,"info")}}async function p(_){var R,J,X,Y;F.add("Scanning...","info",1e3);try{const B=await fetch("/api/scan",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s().token}`},body:JSON.stringify({barcode:_})});if(!B.ok){const U=await B.json();throw new Error(U.error||"Scan failed")}const g=await B.json();F.add(g.message,"success"),g.type==="item"&&((R=g.data)!=null&&R.id)?K(`${y}/dashboard/items/${g.data.id}`):g.type==="box"&&((J=g.data)!=null&&J.id)?(console.log("Box scanned:",g.data),F.add(`Box ${g.data.name||g.data.id} scanned`,"success")):g.type==="place"&&((X=g.data)!=null&&X.id)?K(`${y}/dashboard/warehouse/${g.data.id}`):g.type==="product"&&((Y=g.data)!=null&&Y.id)?K(`${y}/dashboard/items/${g.data.id}`):g.type==="label"&&console.log("Label scanned:",g.data)}catch(B){console.error("Scan error:",B),F.add(`Error: ${B.message}`,"error")}}Ge(()=>r(),()=>{r().lastMessage&&u(r().lastMessage)}),Ke(),de();var v=fa(),S=N(v),a=w(N(S),2),n=w(N(a),2);va(n,{}),x(a);var m=w(a,2),c=N(m);let i;var f=w(c,2);let h;var C=w(f,2);let $;var E=w(C,2);let T;var I=w(E,2);let W;var A=w(I,2);let j;var q=w(A,2);let Z;var z=w(q,2);let H;x(m);var Q=w(m,2),se=N(Q),te=N(se),Oe=N(te,!0);x(te);var pe=w(te,2),Ae=N(pe,!0);x(pe),x(se);var Ie=w(se,2);x(Q),x(S);var re=w(S,2),We=N(re);Ze(We,e,"default",{}),x(re);var Re=w(re,2);ia(Re,{}),x(v),fe((_,R,J,X,Y,B,g)=>{P(c,"href",`${y??""}/dashboard`),i=O(c,1,"svelte-2agd5u",null,i,{active:o().url.pathname===`${y}/dashboard`||o().url.pathname==="/dashboard"}),P(f,"href",`${y??""}/dashboard/items`),h=O(f,1,"svelte-2agd5u",null,h,_),P(C,"href",`${y??""}/dashboard/warehouse`),$=O(C,1,"svelte-2agd5u",null,$,R),P(E,"href",`${y??""}/dashboard/shipping`),T=O(E,1,"svelte-2agd5u",null,T,J),P(I,"href",`${y??""}/dashboard/rma`),W=O(I,1,"svelte-2agd5u",null,W,X),P(A,"href",`${y??""}/dashboard/print`),j=O(A,1,"svelte-2agd5u",null,j,Y),P(q,"href",`${y??""}/dashboard/devices`),Z=O(q,1,"svelte-2agd5u",null,Z,B),P(z,"href",`${y??""}/dashboard/users`),H=O(z,1,"svelte-2agd5u",null,H,g),V(Oe,(s(),ce(()=>{var U;return((U=s().currentUser)==null?void 0:U.username)||"User"}))),V(Ae,(s(),ce(()=>{var U;return((U=s().currentUser)==null?void 0:U.role)||"Operator"})))},[()=>({active:o().url.pathname.includes("/items")}),()=>({active:o().url.pathname.includes("/warehouse")}),()=>({active:o().url.pathname.includes("/shipping")}),()=>({active:o().url.pathname.includes("/rma")}),()=>({active:o().url.pathname.includes("/print")}),()=>({active:o().url.pathname.includes("/devices")}),()=>({active:o().url.pathname.includes("/users")})]),Ee("click",Ie,b),M(t,v),ve(),d()}export{ka as component};
