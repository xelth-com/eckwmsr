import{f as _,a as f,c as Ve}from"../chunks/DwaBocJP.js";import{i as Ze}from"../chunks/Cn36vQlI.js";import{o as Je}from"../chunks/CbLRd9uU.js";import{z as Qe,B as et,D as s,c as v,m as E,b as t,C as o,F as i,G as te,E as tt,A as L,H as $,K as at}from"../chunks/D8pH6ZKL.js";import{e as D,s as B}from"../chunks/DMOeGUlm.js";import{i as I}from"../chunks/BXZ4KMWb.js";import{s as je,e as st,i as it}from"../chunks/CaL8-jqQ.js";import{s as rt,r as ae}from"../chunks/CeRkQ_jF.js";import{s as xe}from"../chunks/BWrQZ7tB.js";import{b as se}from"../chunks/DmFdKuaY.js";import{b as ot}from"../chunks/CMTjv1Cc.js";import{a as lt,s as nt}from"../chunks/wVSw00Z_.js";import{p as vt}from"../chunks/_DTFJL5n.js";import{a as S}from"../chunks/D_yn4hlI.js";import{g as dt}from"../chunks/D11uLj64.js";import{t as k}from"../chunks/DEEbTplX.js";var ct=_('<h1 class="svelte-174jrif"> <span class="blueprint-label svelte-174jrif">Blueprint</span></h1> <div class="actions"><button> </button></div>',1),ut=_('<h1 class="svelte-174jrif">Warehouse Blueprint</h1>'),ft=_('<div class="loading">Loading blueprint...</div>'),pt=_('<div class="error"> </div>'),mt=_('<div class="edit-form"><div class="form-group svelte-174jrif"><label class="svelte-174jrif">Name</label> <input type="text" class="svelte-174jrif"/></div> <div class="form-group svelte-174jrif"><label class="svelte-174jrif">Columns</label> <input type="number" class="svelte-174jrif"/></div> <div class="form-group svelte-174jrif"><label class="svelte-174jrif">Rows</label> <input type="number" class="svelte-174jrif"/></div> <div class="form-group svelte-174jrif"><label class="svelte-174jrif">Rotation (°)</label> <select class="svelte-174jrif"><option>0°</option><option>90°</option><option>180°</option><option>270°</option></select></div> <div class="form-actions svelte-174jrif"><button class="btn secondary svelte-174jrif">Delete</button> <button class="btn primary svelte-174jrif">Update</button></div></div>'),_t=_('<div class="hint svelte-174jrif">Select a rack to edit properties.</div>'),gt=_('<div class="editor-sidebar svelte-174jrif"><h3 class="svelte-174jrif">Rack Properties</h3> <div class="sidebar-actions"><button class="btn primary full-width svelte-174jrif">+ Add Rack</button></div> <!></div>'),bt=_('<span class="rack-info svelte-174jrif"> </span>'),ht=_('<div><div class="rack-label svelte-174jrif"><span class="rack-name svelte-174jrif"> </span> <!></div></div>'),wt=_(`<div class="empty-canvas svelte-174jrif">No racks. Click 'Edit Layout' to add one.</div>`),jt=_('<div class="layout-container svelte-174jrif"><!>  <div class="viewport svelte-174jrif"><div class="canvas svelte-174jrif"><!> <!></div></div></div> <div class="controls svelte-174jrif"><div class="legend svelte-174jrif"><div class="legend-item svelte-174jrif"><span class="box rack-box svelte-174jrif"></span> Rack</div> <div class="legend-item svelte-174jrif"><span class="box selected-box svelte-174jrif"></span> Selected</div></div> <div class="info svelte-174jrif"> </div></div>',1),xt=_('<div class="blueprint-page svelte-174jrif"><div class="header svelte-174jrif"><button class="back-btn svelte-174jrif">← Back</button> <div class="title-row svelte-174jrif"><!></div></div> <!></div>');function At(ye,ke){Qe(ke,!1);const Re=()=>lt(vt,"$page",Ee),[Ee,$e]=nt();let ie=Re().params.id,N=E(null),F=E(!0),H=E(null),r=E([]),x=E(!1),p=E(null),W=!1,P={x:0,y:0},C=null,l=E({name:"",columns:1,rows:1,rotation:0});const re=50;Je(async()=>{await De()});async function De(){try{v(F,!0),v(N,await S.get(`/api/warehouse/${ie}`)),v(r,t(N).racks||[])}catch(e){v(H,e.message),k.add("Error loading warehouse","error")}finally{v(F,!1)}}function Ie(){dt("/dashboard/warehouse")}function Le(){v(x,!t(x)),v(p,null)}function Be(e){const a=e.visualWidth>0?e.visualWidth:e.columns*re,c=e.visualHeight>0?e.visualHeight:e.rows*re;return`
            left: ${e.posX||0}px;
            top: ${e.posY||0}px;
            width: ${a}px;
            height: ${c}px;
            transform: rotate(${e.rotation||0}deg);
        `}function Ce(e,a){if(!t(x))return;e.stopPropagation(),W=!0,C=a.id,ne(a);const m=e.currentTarget.getBoundingClientRect();P={x:e.clientX-m.left,y:e.clientY-m.top},window.addEventListener("mousemove",oe),window.addEventListener("mouseup",le)}function oe(e){if(!W||!C)return;const c=document.querySelector(".canvas").getBoundingClientRect();let m=e.clientX-c.left-P.x,b=e.clientY-c.top-P.y;m=Math.round(m/10)*10,b=Math.round(b/10)*10,m=Math.max(0,m),b=Math.max(0,b);const n=t(r).findIndex(h=>h.id===C);n!==-1&&($(r,t(r)[n].posX=m),$(r,t(r)[n].posY=b),v(r,[...t(r)]))}async function le(){if(!W)return;const e=t(r).find(a=>a.id===C);e&&await Me(e),W=!1,C=null,window.removeEventListener("mousemove",oe),window.removeEventListener("mouseup",le)}async function Me(e){try{await S.put(`/api/warehouse/racks/${e.id}`,{posX:e.posX,posY:e.posY})}catch{k.add("Failed to save position","error")}}function ne(e){v(p,e),v(l,{name:e.name,columns:e.columns,rows:e.rows,rotation:e.rotation||0})}function Xe(){v(p,null)}async function Ye(){if(t(p))try{const e=await S.put(`/api/warehouse/racks/${t(p).id}`,t(l)),a=t(r).findIndex(c=>c.id===t(p).id);a!==-1&&($(r,t(r)[a]={...t(r)[a],...e}),v(r,[...t(r)])),k.add("Rack updated","success")}catch(e){k.add(e.message,"error")}}async function Se(){const e=prompt("New Rack Name:");if(e)try{const a=await S.post("/api/warehouse/racks",{warehouseId:parseInt(ie),name:e,columns:1,rows:1,posX:50,posY:50,startIndex:0});v(r,[...t(r),a]),ne(a),k.add("Rack created","success")}catch(a){k.add(a.message,"error")}}async function Ne(){if(!(!t(p)||!confirm("Delete this rack?")))try{await S.delete(`/api/warehouse/racks/${t(p).id}`),v(r,t(r).filter(e=>e.id!==t(p).id)),v(p,null),k.add("Rack deleted","success")}catch(e){k.add(e.message,"error")}}function We(e){e.target.classList.contains("canvas")&&Xe()}Ze();var G=xt(),T=s(G),ve=s(T),de=o(ve,2),Ae=s(de);{var Fe=e=>{var a=ct(),c=te(a),m=s(c);tt(),i(c);var b=o(c,2),n=s(b),h=s(n,!0);i(n),i(b),L(()=>{B(m,`${t(N).name??""} `),je(n,1,`btn ${t(x)?"active":""}`,"svelte-174jrif"),B(h,t(x)?"Done Editing":"Edit Layout")}),D("click",n,Le),f(e,a)},He=e=>{var a=ut();f(e,a)};I(Ae,e=>{t(N)?e(Fe):e(He,!1)})}i(de),i(T);var Pe=o(T,2);{var Ge=e=>{var a=ft();f(e,a)},Te=e=>{var a=Ve(),c=te(a);{var m=n=>{var h=pt(),M=s(h,!0);i(h),L(()=>B(M,t(H))),f(n,h)},b=n=>{var h=jt(),M=te(h),ce=s(M);{var qe=j=>{var d=gt(),g=o(s(d),2),X=s(g);i(g);var Y=o(g,2);{var z=y=>{var u=mt(),w=s(u),A=o(s(w),2);ae(A),i(w);var O=o(w,2),_e=o(s(O),2);ae(_e),i(O);var U=o(O,2),ge=o(s(U),2);ae(ge),i(U);var V=o(U,2),Z=o(s(V),2);L(()=>{t(l),at(()=>{})});var J=s(Z);J.value=J.__value=0;var Q=o(J);Q.value=Q.__value=90;var ee=o(Q);ee.value=ee.__value=180;var be=o(ee);be.value=be.__value=270,i(Z),i(V);var he=o(V,2),we=s(he),Ue=o(we,2);i(he),i(u),se(A,()=>t(l).name,R=>$(l,t(l).name=R)),se(_e,()=>t(l).columns,R=>$(l,t(l).columns=R)),se(ge,()=>t(l).rows,R=>$(l,t(l).rows=R)),ot(Z,()=>t(l).rotation,R=>$(l,t(l).rotation=R)),D("click",we,Ne),D("click",Ue,Ye),f(y,u)},K=y=>{var u=_t();f(y,u)};I(Y,y=>{t(p)?y(z):y(K,!1)})}i(d),D("click",X,Se),f(j,d)};I(ce,j=>{t(x)&&j(qe)})}var q=o(ce,2),ue=s(q),fe=s(ue);st(fe,1,()=>t(r),it,(j,d)=>{var g=ht(),X=s(g),Y=s(X),z=s(Y,!0);i(Y);var K=o(Y,2);{var y=u=>{var w=bt(),A=s(w);i(w),L(()=>B(A,`${t(d).columns??""}×${t(d).rows??""}`)),f(u,w)};I(K,u=>{t(x)||u(y)})}i(X),i(g),L(u=>{var w;je(g,1,`rack ${((w=t(p))==null?void 0:w.id)===t(d).id?"selected":""}`,"svelte-174jrif"),xe(g,u),rt(g,"title",t(d).name),xe(X,`transform: rotate(-${(t(d).rotation||0)??""}deg);`),B(z,t(d).name)},[()=>Be(t(d))]),D("mousedown",g,u=>Ce(u,t(d))),f(j,g)});var ze=o(fe,2);{var Ke=j=>{var d=wt();f(j,d)};I(ze,j=>{t(r).length===0&&j(Ke)})}i(ue),i(q),i(M);var pe=o(M,2),me=o(s(pe),2),Oe=s(me);i(me),i(pe),L(()=>B(Oe,`${t(r).length??""} racks | ${t(x)?"Edit Mode Active":"View Mode"}`)),D("click",q,We),f(n,h)};I(c,n=>{t(H)?n(m):n(b,!1)},!0)}f(e,a)};I(Pe,e=>{t(F)?e(Ge):e(Te,!1)})}i(G),D("click",ve,Ie),f(ye,G),et(),$e()}export{At as component};
