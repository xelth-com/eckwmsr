import{a as n,f as b,t as xe}from"../chunks/BygaA0WS.js";import{i as Ae}from"../chunks/BqIW1Qmb.js";import{z as Ue,G as De,J as Ce,B as Ee,C as l,D as s,c as o,F as t,b as e,m as G,A as se,E as Pe,H as U}from"../chunks/CN5Z31N9.js";import{e as m,s as w}from"../chunks/DAV6nA3v.js";import{i as X}from"../chunks/CU63fefz.js";import{e as Le,s as de,i as Ne}from"../chunks/DFBiLcyC.js";import{r as M,s as re}from"../chunks/BZk0zrkd.js";import{b as H,a as Se}from"../chunks/De01lyDX.js";import{b as Fe}from"../chunks/DwKrkxP9.js";import{s as Me}from"../chunks/Bfc47y5P.js";import{b as je}from"../chunks/gYmV0BzS.js";import{a as K}from"../chunks/Nceboc1J.js";import{t as _}from"../chunks/DycCOpGa.js";var qe=b('<div class="loading svelte-1m3dwdc">Loading users...</div>'),Ie=b('<div class="empty svelte-1m3dwdc">No users found. Create one to get started.</div>'),Je=b('<span class="pin-set svelte-1m3dwdc">&#x2713; Set</span>'),Re=b('<span class="pin-none svelte-1m3dwdc">-</span>'),ze=b('<span class="muted svelte-1m3dwdc">never</span>'),Be=b('<tr><td class="svelte-1m3dwdc"><button title="Click to toggle"> </button></td><td class="name-cell svelte-1m3dwdc"> </td><td class="svelte-1m3dwdc"><div class="username svelte-1m3dwdc"> </div> <div class="email svelte-1m3dwdc"> </div></td><td class="svelte-1m3dwdc"><span> </span></td><td class="svelte-1m3dwdc"><!></td><td class="date-cell svelte-1m3dwdc"><!></td><td class="actions-cell svelte-1m3dwdc"><button class="btn-icon svelte-1m3dwdc" title="Edit">&#9998;</button> <button class="btn-icon delete svelte-1m3dwdc" title="Delete">&#128465;</button></td></tr>'),Ge=b('<div class="table-container svelte-1m3dwdc"><table class="svelte-1m3dwdc"><thead><tr><th class="svelte-1m3dwdc">Status</th><th class="svelte-1m3dwdc">Name</th><th class="svelte-1m3dwdc">Username / Email</th><th class="svelte-1m3dwdc">Role</th><th class="svelte-1m3dwdc">PIN</th><th class="svelte-1m3dwdc">Last Login</th><th class="svelte-1m3dwdc">Actions</th></tr></thead><tbody></tbody></table></div>'),He=b('<div class="modal-backdrop svelte-1m3dwdc"><div class="modal svelte-1m3dwdc"><h2 class="svelte-1m3dwdc"> </h2> <div class="form-row svelte-1m3dwdc"><div class="form-group svelte-1m3dwdc"><label for="username" class="svelte-1m3dwdc">Username</label> <input id="username" type="text" placeholder="jdoe" class="svelte-1m3dwdc"/></div> <div class="form-group svelte-1m3dwdc"><label for="email" class="svelte-1m3dwdc">Email</label> <input id="email" type="email" placeholder="john@example.com" class="svelte-1m3dwdc"/></div></div> <div class="form-group svelte-1m3dwdc"><label for="name" class="svelte-1m3dwdc">Full Name</label> <input id="name" type="text" placeholder="John Doe" class="svelte-1m3dwdc"/></div> <div class="form-row svelte-1m3dwdc"><div class="form-group svelte-1m3dwdc"><label for="role" class="svelte-1m3dwdc">Role</label> <select id="role" class="svelte-1m3dwdc"><option>User</option><option>Admin</option><option>Device</option></select></div> <div class="form-group svelte-1m3dwdc"><label for="pin" class="svelte-1m3dwdc">PDA PIN (4 digits)</label> <input id="pin" type="text" maxlength="4" pattern="[0-9]*" inputmode="numeric" class="svelte-1m3dwdc"/></div></div> <div class="form-group svelte-1m3dwdc"><label for="password" class="svelte-1m3dwdc"> </label> <input id="password" type="password" class="svelte-1m3dwdc"/></div> <div class="form-check svelte-1m3dwdc"><input type="checkbox" id="active"/> <label for="active" class="svelte-1m3dwdc">Account Active</label></div> <div class="modal-actions svelte-1m3dwdc"><button class="btn secondary svelte-1m3dwdc">Cancel</button> <button class="btn primary svelte-1m3dwdc"> </button></div></div></div>'),Ke=b('<div class="page svelte-1m3dwdc"><header class="svelte-1m3dwdc"><h1 class="svelte-1m3dwdc">User Management</h1> <button class="btn primary svelte-1m3dwdc">+ Add User</button></header> <!></div> <!>',1);function da(ve,le){Ue(le,!1);let Y=G([]),Z=G(!0),D=G(!1),p=G(!1),d=G({id:"",username:"",email:"",name:"",role:"user",password:"",pin:"",isActive:!0});De(()=>{O()});async function O(){o(Z,!0);try{o(Y,await K.get("/api/admin/users")||[])}catch(a){_.add("Failed to load users: "+a.message,"error")}finally{o(Z,!1)}}function ce(){o(d,{id:"",username:"",email:"",name:"",role:"user",password:"",pin:"",isActive:!0}),o(p,!1),o(D,!0)}function oe(a){o(d,{id:a.id,username:a.username,email:a.email,name:a.name||"",role:a.role,password:"",pin:"",isActive:a.isActive}),o(p,!0),o(D,!0)}async function ne(){try{if(e(p)){const a={...e(d)};a.password||delete a.password,a.pin||delete a.pin,await K.put(`/api/admin/users/${e(d).id}`,a),_.add("User updated","success")}else{if(!e(d).username||!e(d).email||!e(d).password){_.add("Username, email and password are required","error");return}await K.post("/api/admin/users",e(d)),_.add("User created","success")}o(D,!1),O()}catch(a){_.add(a.message,"error")}}async function me(a,v){if(confirm(`Delete user "${v}"?`))try{await K.delete(`/api/admin/users/${a}`),_.add("User deleted","success"),O()}catch(u){_.add(u.message,"error")}}async function pe(a){try{await K.put(`/api/admin/users/${a.id}`,{isActive:!a.isActive}),_.add(`User ${a.isActive?"disabled":"enabled"}`,"success"),O()}catch(v){_.add(v.message,"error")}}Ae();var ie=Ke(),$=Ce(ie),ee=s($),ue=l(s(ee),2);t(ee);var we=l(ee,2);{var _e=a=>{var v=qe();n(a,v)},be=a=>{var v=Ie();n(a,v)},fe=a=>{var v=Ge(),u=s(v),C=l(s(u));Le(C,5,()=>e(Y),Ne,(ae,i)=>{var f=Be();let E;var P=s(f),g=s(P),j=s(g,!0);t(g),t(P);var L=l(P),q=s(L,!0);t(L);var y=l(L),k=s(y),I=s(k,!0);t(k);var N=l(k,2),Q=s(N,!0);t(N),t(y);var S=l(y),x=s(S),J=s(x,!0);t(x),t(S);var A=l(S),te=s(A);{var R=c=>{var h=Je();n(c,h)},z=c=>{var h=Re();n(c,h)};X(te,c=>{e(i).hasPin?c(R):c(z,!1)})}t(A);var F=l(A),T=s(F);{var V=c=>{var h=xe();se(ke=>w(h,ke),[()=>new Date(e(i).lastLogin).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"2-digit"})]),n(c,h)},B=c=>{var h=ze();n(c,h)};X(T,c=>{e(i).lastLogin?c(V):c(B,!1)})}t(F);var W=l(F),r=s(W),ye=l(r,2);t(W),t(f),se(()=>{E=de(f,1,"svelte-1m3dwdc",null,E,{disabled:!e(i).isActive}),de(g,1,`badge ${e(i).isActive?"active":"inactive"}`,"svelte-1m3dwdc"),w(j,e(i).isActive?"Active":"Disabled"),w(q,e(i).name||"-"),w(I,e(i).username),w(Q,e(i).email),de(x,1,`role-badge ${e(i).role??""}`,"svelte-1m3dwdc"),w(J,e(i).role)}),m("click",g,()=>pe(e(i))),m("click",r,()=>oe(e(i))),m("click",ye,()=>me(e(i).id,e(i).username)),n(ae,f)}),t(C),t(u),t(v),n(a,v)};X(we,a=>{e(Z)?a(_e):e(Y).length===0?a(be,1):a(fe,!1)})}t($);var he=l($,2);{var ge=a=>{var v=He(),u=s(v),C=s(u),ae=s(C,!0);t(C);var i=l(C,2),f=s(i),E=l(s(f),2);M(E),t(f);var P=l(f,2),g=l(s(P),2);M(g),t(P),t(i);var j=l(i,2),L=l(s(j),2);M(L),t(j);var q=l(j,2),y=s(q),k=l(s(y),2),I=s(k);I.value=I.__value="user";var N=l(I);N.value=N.__value="admin";var Q=l(N);Q.value=Q.__value="device",t(k),t(y);var S=l(y,2),x=l(s(S),2);M(x),t(S),t(q);var J=l(q,2),A=s(J),te=s(A,!0);t(A);var R=l(A,2);M(R),t(J);var z=l(J,2),F=s(z);M(F),Pe(2),t(z);var T=l(z,2),V=s(T),B=l(V,2),W=s(B,!0);t(B),t(T),t(u),t(v),se(()=>{w(ae,e(p)?"Edit User":"Create User"),E.disabled=e(p),re(x,"placeholder",e(p)?"blank = keep":"1234"),w(te,e(p)?"New Password (blank to keep)":"Password"),re(R,"placeholder",e(p)?"blank = keep current":"required"),w(W,e(p)?"Save Changes":"Create User")}),H(E,()=>e(d).username,r=>U(d,e(d).username=r)),H(g,()=>e(d).email,r=>U(d,e(d).email=r)),H(L,()=>e(d).name,r=>U(d,e(d).name=r)),Fe(k,()=>e(d).role,r=>U(d,e(d).role=r)),H(x,()=>e(d).pin,r=>U(d,e(d).pin=r)),H(R,()=>e(d).password,r=>U(d,e(d).password=r)),Se(F,()=>e(d).isActive,r=>U(d,e(d).isActive=r)),m("click",V,()=>o(D,!1)),m("click",B,ne),m("click",u,Me(function(r){je.call(this,le,r)})),m("keydown",u,()=>{}),m("click",v,()=>o(D,!1)),m("keydown",v,()=>{}),n(a,v)};X(he,a=>{e(D)&&a(ge)})}m("click",ue,ce),n(ve,ie),Ee()}export{da as component};
