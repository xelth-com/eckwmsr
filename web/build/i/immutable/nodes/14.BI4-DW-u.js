import{a as k,f as b}from"../chunks/BygaA0WS.js";import{i as qe}from"../chunks/BqIW1Qmb.js";import{z as Ge,G as Oe,A as P,B as Ue,c as _,D as l,C as i,F as v,b as e,m as C,P as ze,H as h}from"../chunks/CN5Z31N9.js";import{s as x,e as g}from"../chunks/DAV6nA3v.js";import{i as ie}from"../chunks/CU63fefz.js";import{e as we,s as xe}from"../chunks/DFBiLcyC.js";import{s as je,r as y}from"../chunks/BZk0zrkd.js";import{s as ye}from"../chunks/DZHojTuh.js";import{b as R}from"../chunks/De01lyDX.js";import{b as Je}from"../chunks/DwKrkxP9.js";import{b as Ke}from"../chunks/iBrAFCEs.js";import{s as Qe}from"../chunks/Bfc47y5P.js";import{a as S}from"../chunks/Nceboc1J.js";import{t as I}from"../chunks/DycCOpGa.js";import{b as Ze}from"../chunks/BODtoanW.js";var es=b('<div class="loading svelte-1p6svkz">Loading...</div>'),ss=b('<button class="btn btn-delete svelte-1p6svkz">Delete Rack</button>'),ts=b('<div><div class="name svelte-1p6svkz"> </div> <div class="meta svelte-1p6svkz"> </div></div>'),as=b('<div class="no-racks svelte-1p6svkz">No racks yet. Create one above.</div>'),is=b('<div><div class="indicator-dot svelte-1p6svkz"></div> <div class="rack-label svelte-1p6svkz"><span class="rack-name svelte-1p6svkz"> </span> <span class="dims svelte-1p6svkz"> </span></div></div>'),vs=b('<div class="main-layout svelte-1p6svkz"><div class="sidebar svelte-1p6svkz"><h2 class="svelte-1p6svkz">Rack Management</h2> <div class="rack-form svelte-1p6svkz"><div class="form-group svelte-1p6svkz"><label class="svelte-1p6svkz">Name</label> <input type="text" placeholder="e.g. Regal A" class="svelte-1p6svkz"/></div> <div class="form-row svelte-1p6svkz"><div class="form-group svelte-1p6svkz"><label class="svelte-1p6svkz">Cols</label> <input type="number" min="1" placeholder="5" class="svelte-1p6svkz"/></div> <div class="form-group svelte-1p6svkz"><label class="svelte-1p6svkz">Rows</label> <input type="number" min="1" placeholder="10" class="svelte-1p6svkz"/></div></div> <div class="form-group svelte-1p6svkz"><label class="svelte-1p6svkz">Start ID</label> <input type="number" placeholder="Auto" class="svelte-1p6svkz"/></div> <div class="form-row svelte-1p6svkz"><div class="form-group svelte-1p6svkz"><label class="svelte-1p6svkz">Width (px)</label> <input type="number" placeholder="Auto" class="svelte-1p6svkz"/></div> <div class="form-group svelte-1p6svkz"><label class="svelte-1p6svkz">Height (px)</label> <input type="number" placeholder="Auto" class="svelte-1p6svkz"/></div></div> <div class="form-group svelte-1p6svkz"><label class="svelte-1p6svkz">Rotation</label> <select class="svelte-1p6svkz"><option>0 (Horizontal)</option><option>90 (Vertical)</option><option>180 (Inverted)</option><option>270 (Vert. Inverted)</option></select></div> <div class="form-row svelte-1p6svkz"><button class="btn btn-primary svelte-1p6svkz"> </button> <button class="btn btn-secondary svelte-1p6svkz">Clear</button></div> <!></div> <div class="racks-list svelte-1p6svkz"><!> <!></div></div>  <div class="canvas-area svelte-1p6svkz"><div class="canvas-container svelte-1p6svkz"></div></div></div>'),ls=b('<div class="blueprint-page svelte-1p6svkz"><header class="svelte-1p6svkz"><a class="back-link svelte-1p6svkz">Home</a> <h1 class="svelte-1p6svkz">Warehouse Blueprint</h1> <div class="rack-count svelte-1p6svkz"> </div></header> <!></div>');function ws(Re,Ie){Ge(Ie,!1);let p=C([]),c=C(null),ve=C(!0),t=C({name:"",columns:1,rows:1,startIndex:"",visualWidth:0,visualHeight:0,rotation:0}),D=!1,z=null,A={x:0,y:0},$=C();Oe(async()=>{await T(),_(ve,!1)});async function T(){try{_(p,await S.get("/api/warehouse/racks"))}catch{I.add("Failed to load racks","error")}}function N(s){_(c,s),_(t,{name:s.name||"",columns:s.columns||1,rows:s.rows||1,startIndex:s.startIndex||"",visualWidth:s.visualWidth||0,visualHeight:s.visualHeight||0,rotation:s.rotation||0})}function L(){_(c,null),_(t,{name:"",columns:1,rows:1,startIndex:"",visualWidth:0,visualHeight:0,rotation:0})}async function $e(){var r,n,d;if(!e(t).name||!e(t).columns||!e(t).rows){I.add("Please fill Name, Cols, and Rows","error");return}const s={id:((r=e(c))==null?void 0:r.id)||null,name:e(t).name,columns:parseInt(e(t).columns),rows:parseInt(e(t).rows),startIndex:e(t).startIndex===""?-1:parseInt(e(t).startIndex),visualWidth:parseInt(e(t).visualWidth)||0,visualHeight:parseInt(e(t).visualHeight)||0,rotation:parseInt(e(t).rotation)||0,posX:((n=e(c))==null?void 0:n.posX)||0,posY:((d=e(c))==null?void 0:d.posY)||0};try{await S.post("/api/warehouse/racks",s),I.add("Rack saved!","success"),e(c)||L(),await T()}catch{I.add("Failed to save rack","error")}}async function He(){if(!(!e(c)||!confirm("Delete this rack?")))try{await S.delete(`/api/warehouse/racks/${e(c).id}`),L(),await T(),I.add("Rack deleted","success")}catch{I.add("Failed to delete rack","error")}}function We(s,r){D=!0,z=r,N(r);const d=s.currentTarget.getBoundingClientRect();A.x=s.clientX-d.left,A.y=s.clientY-d.top,window.addEventListener("mousemove",le),window.addEventListener("mouseup",oe)}function le(s){if(!D||!z||!e($))return;const r=e($).getBoundingClientRect();let n=s.clientX-r.left-A.x,d=s.clientY-r.top-A.y;n=Math.round(n/10)*10,d=Math.round(d/10)*10,n=Math.max(0,n),d=Math.max(0,d);const m=e(p).findIndex(M=>M.id===z.id);m!==-1&&(h(p,e(p)[m]={...e(p)[m],posX:n,posY:d}),_(p,e(p)))}async function oe(){if(D&&z){const s=e(p).find(r=>r.id===z.id);if(s)try{await S.post("/api/warehouse/racks",s)}catch(r){console.error("Auto-save position failed",r)}}D=!1,z=null,window.removeEventListener("mousemove",le),window.removeEventListener("mouseup",oe)}function Ce(s){let r=s.visualWidth>0?s.visualWidth:s.columns*50,n=s.visualHeight>0?s.visualHeight:s.rows*50;return{w:r,h:n}}function De(s){const r=s||0;return(r===90||r===270?90:0)-r}function Ae(s){(s.target===e($)||s.target.classList.contains("canvas-container"))&&L()}function Le(s){return s.columns*s.rows}qe();var V=ls(),q=l(V),re=l(q),ne=i(re,4),Me=l(ne);v(ne),v(q);var Xe=i(q,2);{var Ye=s=>{var r=es();k(s,r)},Ee=s=>{var r=vs(),n=l(r),d=i(l(n),2),m=l(d),M=i(l(m),2);y(M),v(m);var G=i(m,2),O=l(G),de=i(l(O),2);y(de),v(O);var pe=i(O,2),ce=i(l(pe),2);y(ce),v(pe),v(G);var U=i(G,2),ue=i(l(U),2);y(ue),v(U);var j=i(U,2),J=l(j),me=i(l(J),2);y(me),v(J);var fe=i(J,2),_e=i(l(fe),2);y(_e),v(fe),v(j);var K=i(j,2),Q=i(l(K),2),Z=l(Q);Z.value=Z.__value=0;var ee=i(Z);ee.value=ee.__value=90;var se=i(ee);se.value=se.__value=180;var he=i(se);he.value=he.__value=270,v(Q),v(K);var te=i(K,2),X=l(te),Fe=l(X);v(X);var Be=i(X,2);v(te);var Pe=i(te,2);{var Se=a=>{var o=ss();g("click",o,He),k(a,o)};ie(Pe,a=>{e(c)&&a(Se)})}v(d);var ke=i(d,2),ge=l(ke);we(ge,1,()=>e(p),a=>a.id,(a,o)=>{var f=ts();let E;var u=l(f),F=l(u,!0);v(u);var w=i(u,2),H=l(w);v(w),v(f),P(ae=>{var W;E=xe(f,1,"rack-item svelte-1p6svkz",null,E,{active:((W=e(c))==null?void 0:W.id)===e(o).id}),x(F,e(o).name||`Rack #${e(o).id}`),x(H,`${e(o).columns??""}x${e(o).rows??""} = ${ae??""} places | Start: ${e(o).startIndex??""}`)},[()=>Le(e(o))]),g("click",f,()=>N(e(o))),k(a,f)});var Te=i(ge,2);{var Ne=a=>{var o=as();k(a,o)};ie(Te,a=>{e(p).length===0&&a(Ne)})}v(ke),v(n);var Y=i(n,2),be=l(Y);we(be,5,()=>e(p),a=>a.id,(a,o)=>{const f=ze(()=>Ce(e(o))),E=ze(()=>De(e(o).rotation));var u=is();let F;var w=i(l(u),2),H=l(w),ae=l(H,!0);v(H);var W=i(H,2),Ve=l(W);v(W),v(w),v(u),P(()=>{var B;F=xe(u,1,"rack-node svelte-1p6svkz",null,F,{selected:((B=e(c))==null?void 0:B.id)===e(o).id}),ye(u,`
                                left: ${(e(o).posX||0)??""}px;
                                top: ${(e(o).posY||0)??""}px;
                                width: ${e(f).w??""}px;
                                height: ${e(f).h??""}px;
                                transform: rotate(${(e(o).rotation||0)??""}deg);
                            `),ye(w,`transform: rotate(${e(E)??""}deg);`),x(ae,e(o).name||`#${e(o).id}`),x(Ve,`${e(o).columns??""}x${e(o).rows??""}`)}),g("mousedown",u,B=>We(B,e(o))),g("click",u,Qe(()=>N(e(o)))),k(a,u)}),v(be),v(Y),Ke(Y,a=>_($,a),()=>e($)),v(r),P(()=>x(Fe,`${e(c)?"Update":"Create"} Rack`)),R(M,()=>e(t).name,a=>h(t,e(t).name=a)),R(de,()=>e(t).columns,a=>h(t,e(t).columns=a)),R(ce,()=>e(t).rows,a=>h(t,e(t).rows=a)),R(ue,()=>e(t).startIndex,a=>h(t,e(t).startIndex=a)),R(me,()=>e(t).visualWidth,a=>h(t,e(t).visualWidth=a)),R(_e,()=>e(t).visualHeight,a=>h(t,e(t).visualHeight=a)),Je(Q,()=>e(t).rotation,a=>h(t,e(t).rotation=a)),g("click",X,$e),g("click",Be,L),g("click",Y,Ae),k(s,r)};ie(Xe,s=>{e(ve)?s(Ye):s(Ee,!1)})}v(V),P(()=>{je(re,"href",`${Ze??""}/dashboard/warehouse`),x(Me,`${e(p).length??""} rack${e(p).length!==1?"s":""}`)}),k(Re,V),Ue()}export{ws as component};
