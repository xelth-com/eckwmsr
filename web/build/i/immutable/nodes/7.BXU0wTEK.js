import{f as o,a as l,c as Sa,t as xe}from"../chunks/DwaBocJP.js";import{i as Ie}from"../chunks/Cn36vQlI.js";import{o as we}from"../chunks/CbLRd9uU.js";import{z as Ae,B as ke,D as s,c as b,m as S,b as a,C as t,F as e,G as Q,A as h,H as ba}from"../chunks/D8pH6ZKL.js";import{e as R,s as _}from"../chunks/DMOeGUlm.js";import{i as p}from"../chunks/BXZ4KMWb.js";import{s as X,e as Ba,i as Pa}from"../chunks/CaL8-jqQ.js";import{r as ga,s as $e}from"../chunks/CeRkQ_jF.js";import{b as ya}from"../chunks/DmFdKuaY.js";import{s as Ce}from"../chunks/Bfc47y5P.js";import{s as ze,a as Ee}from"../chunks/wVSw00Z_.js";import{p as Fe}from"../chunks/_DTFJL5n.js";import{a as Y}from"../chunks/D_yn4hlI.js";import{g as Se}from"../chunks/D11uLj64.js";import{t as O}from"../chunks/DEEbTplX.js";import{b as Da}from"../chunks/DZFsq0ZI.js";var Be=o('<button class="btn secondary svelte-7rm230">Cancel</button> <button class="btn primary svelte-7rm230">Save</button>',1),Pe=o('<button class="btn primary svelte-7rm230">Edit Item</button>'),De=o('<h1 class="svelte-7rm230"> </h1> <div class="actions svelte-7rm230"><!></div>',1),Le=o('<h1 class="svelte-7rm230">Item Details</h1>'),Me=o('<div class="loading">Loading details...</div>'),Re=o('<div class="error"> </div>'),Ue=o('<input type="text" class="code-input svelte-7rm230"/>'),Ve=o('<div class="value code svelte-7rm230"> </div>'),Ke=o('<input type="text" class="svelte-7rm230"/>'),Ne=o('<div class="value svelte-7rm230"> </div>'),Ge=o('<input type="text" class="code-input svelte-7rm230"/>'),He=o('<div class="value code svelte-7rm230"> </div>'),Oe=o('<span class="badge svelte-7rm230">MAIN</span>'),Te=o('<span class="spinner svelte-7rm230">&#x21bb;</span>'),We=o('<div><img alt="Item photo" loading="lazy" class="svelte-7rm230"/> <!> <button class="ai-btn svelte-7rm230" title="AI Analyze"><!></button></div>'),je=o("<span> </span>"),qe=o('<div class="tag-row svelte-7rm230"><span> </span> <!></div>'),Je=o('<p class="svelte-7rm230"><strong>Description:</strong> </p>'),Qe=o('<p class="svelte-7rm230"><strong>OCR:</strong> <code class="svelte-7rm230"> </code></p>'),Xe=o('<span class="pill svelte-7rm230"> </span>'),Ye=o('<div class="tags svelte-7rm230"></div>'),Ze=o('<p class="raw svelte-7rm230"><code class="svelte-7rm230"> </code></p>'),as=o('<div class="analysis-overlay svelte-7rm230"><div class="analysis-header svelte-7rm230"><h4 class="svelte-7rm230">AI Analysis</h4> <button class="close-btn svelte-7rm230">&times;</button></div> <div class="analysis-content svelte-7rm230"><!> <!> <!> <!> <!></div></div>'),es=o('<div class="section gallery-section svelte-7rm230"><h3 class="svelte-7rm230"> </h3> <div class="gallery-grid svelte-7rm230"></div> <!></div>'),ss=o('<div class="detail-grid svelte-7rm230"><div class="section main-info svelte-7rm230"><h3 class="svelte-7rm230">Basic Information</h3> <div class="field svelte-7rm230"><label class="svelte-7rm230">SKU</label> <!></div> <div class="field svelte-7rm230"><label class="svelte-7rm230">Name</label> <!></div> <div class="field svelte-7rm230"><label class="svelte-7rm230">Barcode</label> <!></div> <div class="field svelte-7rm230"><label class="svelte-7rm230">Type</label> <div class="value svelte-7rm230"> </div></div></div> <div class="section stats svelte-7rm230"><h3 class="svelte-7rm230">Inventory Status</h3> <div class="stat-box svelte-7rm230"><span class="label svelte-7rm230">List Price</span> <span class="val svelte-7rm230"> </span></div> <div class="stat-box svelte-7rm230"><span class="label svelte-7rm230">Cost Price</span> <span class="val svelte-7rm230"> </span></div> <div class="stat-box svelte-7rm230"><span class="label svelte-7rm230">Weight</span> <span class="val svelte-7rm230"> </span></div> <div class="stat-box svelte-7rm230"><span class="label svelte-7rm230">Volume</span> <span class="val svelte-7rm230"> </span></div> <div class="stat-box svelte-7rm230"><span class="label svelte-7rm230">Status</span> <span> </span></div></div> <!></div>'),ts=o('<div class="detail-page svelte-7rm230"><div class="header svelte-7rm230"><button class="back-btn svelte-7rm230">&larr; Back</button> <div class="title-row svelte-7rm230"><!></div></div> <!></div>');function hs(La,Ma){Ae(Ma,!1);const Ra=()=>Ee(Fe,"$page",Ua),[Ua,Va]=ze();let n=S(null),T=S([]),ha=S(!0),A=S(!1),Z=S(null),x=S({}),W=S(null),m=S(null);we(async()=>{await Ka()});async function Ka(){try{b(n,await Y.get(`/api/items/${Ra().params.id}`)),b(x,{...a(n)}),await Na()}catch(i){b(Z,i.message)}finally{b(ha,!1)}}async function Na(){if(!a(n))return;const i=a(n).barcode;if(i)try{b(T,await Y.get(`/api/attachments/product/${encodeURIComponent(i)}`))}catch(g){console.warn("Failed to load attachments",g)}}function xa(){a(A)&&b(x,{...a(n)}),b(A,!a(A))}async function Ga(){try{const i=await Y.put(`/api/items/${a(n).id}`,a(x));b(n,i),b(x,{...a(n)}),b(A,!1),O.add("Item updated successfully","success")}catch(i){O.add(i.message,"error")}}function Ha(){Se(`${Da}/dashboard/items`)}function Oa(i){return`${Da}/api/files/${i}`}async function Ta(i){var g,$,L;b(W,i),b(m,null);try{const I=await Y.post("/api/ai/analyze-image",{file_id:i});I.success&&(b(m,{fileId:i,data:I.analysis}),O.add("Analysis complete","success"))}catch(I){(g=I.message)!=null&&g.includes("503")||($=I.message)!=null&&$.includes("unavailable")||(L=I.message)!=null&&L.includes("Service")?O.add("AI Analysis unavailable (Check API Key or Config)","error",5e3):O.add(I.message||"Analysis failed","error")}finally{b(W,null)}}Ie();var aa=ts(),ea=s(aa),Ia=s(ea),wa=t(Ia,2),Wa=s(wa);{var ja=i=>{var g=De(),$=Q(g),L=s($);e($);var I=t($,2),C=s(I);{var z=E=>{var k=Be(),M=Q(k),V=t(M,2);R("click",M,xa),R("click",V,Ga),l(E,k)},U=E=>{var k=Pe();R("click",k,xa),l(E,k)};p(C,E=>{a(A)?E(z):E(U,!1)})}e(I),h(()=>_(L,`${a(A)?"Editing: ":""}${a(n).name??""}`)),l(i,g)},qa=i=>{var g=Le();l(i,g)};p(Wa,i=>{a(n)?i(ja):i(qa,!1)})}e(wa),e(ea);var Ja=t(ea,2);{var Qa=i=>{var g=Me();l(i,g)},Xa=i=>{var g=Sa(),$=Q(g);{var L=C=>{var z=Re(),U=s(z);e(z),h(()=>_(U,`Error: ${a(Z)??""}`)),l(C,z)},I=C=>{var z=Sa(),U=Q(z);{var E=k=>{var M=ss(),V=s(M),sa=t(s(V),2),Ya=t(s(sa),2);{var Za=r=>{var v=Ue();ga(v),ya(v,()=>a(x).default_code,u=>ba(x,a(x).default_code=u)),l(r,v)},ae=r=>{var v=Ve(),u=s(v,!0);e(v),h(()=>_(u,a(n).default_code||"-")),l(r,v)};p(Ya,r=>{a(A)?r(Za):r(ae,!1)})}e(sa);var ta=t(sa,2),ee=t(s(ta),2);{var se=r=>{var v=Ke();ga(v),ya(v,()=>a(x).name,u=>ba(x,a(x).name=u)),l(r,v)},te=r=>{var v=Ne(),u=s(v,!0);e(v),h(()=>_(u,a(n).name)),l(r,v)};p(ee,r=>{a(A)?r(se):r(te,!1)})}e(ta);var ra=t(ta,2),re=t(s(ra),2);{var ve=r=>{var v=Ge();ga(v),ya(v,()=>a(x).barcode,u=>ba(x,a(x).barcode=u)),l(r,v)},le=r=>{var v=He(),u=s(v,!0);e(v),h(()=>_(u,a(n).barcode||"-")),l(r,v)};p(re,r=>{a(A)?r(ve):r(le,!1)})}e(ra);var Aa=t(ra,2),ka=t(s(Aa),2),ie=s(ka,!0);e(ka),e(Aa),e(V);var va=t(V,2),la=t(s(va),2),$a=t(s(la),2),oe=s($a);e($a),e(la);var ia=t(la,2),Ca=t(s(ia),2),ne=s(Ca);e(Ca),e(ia);var oa=t(ia,2),za=t(s(oa),2),de=s(za);e(za),e(oa);var na=t(oa,2),Ea=t(s(na),2),ce=s(Ea);e(Ea),e(na);var Fa=t(na,2),da=t(s(Fa),2),me=s(da,!0);e(da),e(Fa),e(va);var _e=t(va,2);{var pe=r=>{var v=es(),u=s(v),ue=s(u);e(u);var ca=t(u,2);Ba(ca,5,()=>a(T),Pa,(K,w)=>{var F=We();let j;var N=s(F),G=t(N,2);{var ma=f=>{var P=Oe();l(f,P)};p(G,f=>{a(w).is_main&&f(ma)})}var B=t(G,2),_a=s(B);{var q=f=>{var P=Te();l(f,P)},pa=f=>{var P=xe("✨");l(f,P)};p(_a,f=>{a(W)===a(w).file_id?f(q):f(pa,!1)})}e(B),e(F),h(f=>{j=X(F,1,"photo-card svelte-7rm230",null,j,{main:a(w).is_main}),$e(N,"src",f),B.disabled=a(W)===a(w).file_id},[()=>Oa(a(w).file_id)]),R("click",B,Ce(()=>Ta(a(w).file_id))),l(K,F)}),e(ca);var fe=t(ca,2);{var be=K=>{var w=as(),F=s(w),j=t(s(F),2);e(F);var N=t(F,2),G=s(N);{var ma=d=>{var c=qe(),y=s(c),D=s(y,!0);e(y);var H=t(y,2);{var ua=fa=>{var J=je(),he=s(J);e(J),h(()=>{X(J,1,`tag ${a(m).data.labels_visible?"good":"damaged"}`,"svelte-7rm230"),_(he,`Labels: ${a(m).data.labels_visible?"Visible":"Missing"}`)}),l(fa,J)};p(H,fa=>{a(m).data.labels_visible!==void 0&&fa(ua)})}e(c),h(()=>{X(y,1,`tag condition ${a(m).data.condition??""}`,"svelte-7rm230"),_(D,a(m).data.condition)}),l(d,c)};p(G,d=>{a(m).data.condition&&d(ma)})}var B=t(G,2);{var _a=d=>{var c=Je(),y=t(s(c));e(c),h(()=>_(y,` ${a(m).data.description??""}`)),l(d,c)};p(B,d=>{a(m).data.description&&d(_a)})}var q=t(B,2);{var pa=d=>{var c=Qe(),y=t(s(c),2),D=s(y,!0);e(y),e(c),h(()=>_(D,a(m).data.ocr_text)),l(d,c)};p(q,d=>{a(m).data.ocr_text&&d(pa)})}var f=t(q,2);{var P=d=>{var c=Ye();Ba(c,5,()=>a(m).data.tags,Pa,(y,D)=>{var H=Xe(),ua=s(H,!0);e(H),h(()=>_(ua,a(D))),l(y,H)}),e(c),l(d,c)};p(f,d=>{a(m).data.tags&&d(P)})}var ge=t(f,2);{var ye=d=>{var c=Ze(),y=s(c),D=s(y,!0);e(y),e(c),h(()=>_(D,a(m).data.raw_analysis)),l(d,c)};p(ge,d=>{a(m).data.raw_analysis&&d(ye)})}e(N),e(w),R("click",j,()=>b(m,null)),l(K,w)};p(fe,K=>{a(m)&&K(be)})}e(v),h(()=>_(ue,`Visual Evidence (${a(T).length??""})`)),l(r,v)};p(_e,r=>{a(T).length>0&&r(pe)})}e(M),h((r,v)=>{_(ie,a(n).type||"-"),_(oe,`$${r??""}`),_(ne,`$${v??""}`),_(de,`${(a(n).weight||0)??""} kg`),_(ce,`${(a(n).volume||0)??""} m³`),X(da,1,`val ${a(n).active?"active":"inactive"}`,"svelte-7rm230"),_(me,a(n).active?"Active":"Inactive")},[()=>{var r;return((r=a(n).list_price)==null?void 0:r.toFixed(2))||"0.00"},()=>{var r;return((r=a(n).standard_price)==null?void 0:r.toFixed(2))||"0.00"}]),l(k,M)};p(U,k=>{a(n)&&k(E)},!0)}l(C,z)};p($,C=>{a(Z)?C(L):C(I,!1)},!0)}l(i,g)};p(Ja,i=>{a(ha)?i(Qa):i(Xa,!1)})}e(aa),R("click",Ia,Ha),l(La,aa),ke(),Va()}export{hs as component};
