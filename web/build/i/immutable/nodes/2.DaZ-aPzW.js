import{a as B,f as P,c as Ie}from"../chunks/CVSPybqJ.js";import{i as oe}from"../chunks/BdqhJSGs.js";import{az as Re,_ as We,bd as Me,aA as Le,e as Fe,u as re,be as Be,bf as Ue,bg as De,bh as Pe,q as je,n as z,aV as $e,w as qe,z as ie,B as ce,F as x,D as N,A as le,b as T,G as we,bi as ye,c as ae,m as he,J as ze,C as w,K as Je,M as Ge}from"../chunks/CqpwgXEk.js";import{a as Ke,s as G,e as Se}from"../chunks/D0Wkj3YL.js";import{s as Ve}from"../chunks/NHymQ4I1.js";import{s as F}from"../chunks/CO09g7J9.js";import{e as xe,s as k,i as He}from"../chunks/DKR_uuIj.js";import{s as Ne,a as Q}from"../chunks/CiK6IFzv.js";import{a as te}from"../chunks/DbFcPqlP.js";import{t as I}from"../chunks/C3Rs9I5p.js";import{i as Qe}from"../chunks/NgGcbYIQ.js";import{b as S}from"../chunks/CQ3cvpm9.js";import{g as J}from"../chunks/B_qakWci.js";import{p as Xe}from"../chunks/DIRA5UoF.js";const Ye=()=>performance.now(),R={tick:t=>requestAnimationFrame(t),now:()=>Ye(),tasks:new Set};function Ce(){const t=R.now();R.tasks.forEach(e=>{e.c(t)||(R.tasks.delete(e),e.f())}),R.tasks.size!==0&&R.tick(Ce)}function Ze(t){let e;return R.tasks.size===0&&R.tick(Ce),{promise:new Promise(r=>{R.tasks.add(e={c:t,f:r})}),abort(){R.tasks.delete(e)}}}function X(t,e){$e(()=>{t.dispatchEvent(new CustomEvent(e))})}function ea(t){if(t==="float")return"cssFloat";if(t==="offset")return"cssOffset";if(t.startsWith("--"))return t;const e=t.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(r=>r[0].toUpperCase()+r.slice(1)).join("")}function _e(t){const e={},r=t.split(";");for(const s of r){const[n,c]=s.split(":");if(!n||c===void 0)break;const l=ea(n.trim());e[l]=c.trim()}return e}const aa=t=>t;function be(t,e,r,s){var C;var n=(t&Ue)!==0,c=(t&De)!==0,l=n&&c,m=(t&Be)!==0,f=l?"both":n?"in":"out",h,p=e.inert,y=e.style.overflow,i,a;function d(){return $e(()=>h??(h=r()(e,(s==null?void 0:s())??{},{direction:f})))}var u={is_global:m,in(){var g;if(e.inert=p,!n){a==null||a.abort(),(g=a==null?void 0:a.reset)==null||g.call(a);return}c||i==null||i.abort(),i=ne(e,d(),a,1,()=>{X(e,"introend"),i==null||i.abort(),i=h=void 0,e.style.overflow=y})},out(g){if(!c){g==null||g(),h=void 0;return}e.inert=!0,a=ne(e,d(),i,0,()=>{X(e,"outroend"),g==null||g()})},stop:()=>{i==null||i.abort(),a==null||a.abort()}},_=Re;if(((C=_.nodes).t??(C.t=[])).push(u),n&&Ke){var o=m;if(!o){for(var v=_.parent;v&&(v.f&We)!==0;)for(;(v=v.parent)&&(v.f&Me)===0;);o=!v||(v.f&Le)!==0}o&&Fe(()=>{re(()=>u.in())})}}function ne(t,e,r,s,n){var c=s===1;if(Pe(e)){var l,m=!1;return je(()=>{if(!m){var _=e({direction:c?"in":"out"});l=ne(t,_,r,s,n)}}),{abort:()=>{m=!0,l==null||l.abort()},deactivate:()=>l.deactivate(),reset:()=>l.reset(),t:()=>l.t()}}if(r==null||r.deactivate(),!(e!=null&&e.duration)&&!(e!=null&&e.delay))return X(t,c?"introstart":"outrostart"),n(),{abort:z,deactivate:z,reset:z,t:()=>s};const{delay:f=0,css:h,tick:p,easing:y=aa}=e;var i=[];if(c&&r===void 0&&(p&&p(0,1),h)){var a=_e(h(0,1));i.push(a,a)}var d=()=>1-s,u=t.animate(i,{duration:f,fill:"forwards"});return u.onfinish=()=>{u.cancel(),X(t,c?"introstart":"outrostart");var _=(r==null?void 0:r.t())??1-s;r==null||r.abort();var o=s-_,v=e.duration*Math.abs(o),C=[];if(v>0){var g=!1;if(h)for(var W=Math.ceil(v/16.666666666666668),O=0;O<=W;O+=1){var M=_+o*y(O/W),U=_e(h(M,1-M));C.push(U),g||(g=U.overflow==="hidden")}g&&(t.style.overflow="hidden"),d=()=>{var E=u.currentTime;return _+o*y(E/v)},p&&Ze(()=>{if(u.playState!=="running")return!1;var E=d();return p(E,1-E),!0})}u=t.animate(C,{duration:v,fill:"forwards"}),u.onfinish=()=>{d=()=>s,p==null||p(s,1-s),n()}},{abort:()=>{u&&(u.cancel(),u.effect=null,u.onfinish=z)},deactivate:()=>{n=z},reset:()=>{s===0&&(p==null||p(1,0))},t:()=>d()}}const ta=3e3;function sa(){const{subscribe:t,set:e,update:r}=qe({connected:!1,lastMessage:null,error:null});let s,n,c=!1;function l(){if(s&&(s.readyState===WebSocket.CONNECTING||s.readyState===WebSocket.OPEN))return;const h=window.location.protocol==="https:"?"wss:":"ws:",p=window.location.host,y=`${h}//${p}/E/ws`;console.log(`[WS] Connecting to ${y}...`),s=new WebSocket(y),s.onopen=()=>{console.log("[WS] Connected"),r(i=>({...i,connected:!0,error:null}))},s.onclose=()=>{console.log("[WS] Disconnected"),r(i=>({...i,connected:!1})),c||(clearTimeout(n),n=setTimeout(l,ta))},s.onerror=i=>{console.error("[WS] Connection Error",i),r(a=>({...a,error:"Connection error"}))},s.onmessage=i=>{try{const a=JSON.parse(i.data);a._receivedAt=Date.now(),r(d=>({...d,lastMessage:a}))}catch(a){console.error("[WS] Failed to parse message",a)}}}function m(){c=!0,s&&s.close()}function f(h){s&&s.readyState===WebSocket.OPEN?s.send(JSON.stringify(h)):console.warn("[WS] Cannot send, not connected")}return{subscribe:t,connect:l,close:m,send:f}}const se=sa();function ra(t){const e=t-1;return e*e*e+1}function me(t){const e=typeof t=="string"&&t.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return e?[parseFloat(e[1]),e[2]||"px"]:[t,"px"]}function ge(t,{delay:e=0,duration:r=400,easing:s=ra,x:n=0,y:c=0,opacity:l=0}={}){const m=getComputedStyle(t),f=+m.opacity,h=m.transform==="none"?"":m.transform,p=f*(1-l),[y,i]=me(n),[a,d]=me(c);return{delay:e,duration:r,easing:s,css:(u,_)=>`
			transform: ${h} translate(${(1-u)*y}${i}, ${(1-u)*a}${d});
			opacity: ${f-p*_}`}}var na=P('<div role="alert"> </div>'),oa=P('<div class="toast-container svelte-cqwvc2"></div>');function ia(t,e){ie(e,!1);const r=()=>Q(I,"$toastStore",s),[s,n]=Ne();oe();var c=oa();xe(c,5,r,l=>l.id,(l,m)=>{var f=na(),h=N(f,!0);x(f),le(()=>{k(f,1,`toast ${T(m).type??""}`,"svelte-cqwvc2"),G(h,T(m).message)}),be(1,f,()=>ge,()=>({y:20,duration:300})),be(2,f,()=>ge,()=>({x:20,duration:300})),Se("click",f,()=>I.remove(T(m).id)),B(l,f)}),x(c),B(t,c),ce(),n()}var ca=P('<div class="mesh-node loading svelte-10x5b0t"><span class="node-icon svelte-10x5b0t">‚è≥</span> <span class="node-label svelte-10x5b0t">Loading...</span></div>'),la=P('<div class="mesh-node offline svelte-10x5b0t"><span class="node-icon svelte-10x5b0t">‚ö†Ô∏è</span> <span class="node-label svelte-10x5b0t">No nodes</span></div>'),da=P('<div><span class="node-icon svelte-10x5b0t"> </span> <span class="node-label svelte-10x5b0t"> </span> <span></span></div>'),ua=P('<div class="mesh-status svelte-10x5b0t"><!></div>');function va(t,e){ie(e,!1);let r=he([]),s=he(!0),n;async function c(){try{const a=await fetch(`${S}/mesh/nodes`);a.ok&&(ae(r,await a.json()),ae(s,!1))}catch(a){console.error("Failed to fetch mesh nodes:",a),ae(s,!1)}}we(()=>{c(),n=setInterval(c,3e4)}),ye(()=>{n&&clearInterval(n)});function l(a){switch(a){case"master":return"üåê";case"peer":return"üñ•Ô∏è";case"edge":return"üì±";default:return"üîó"}}function m(a){const d=a.instance_id,u=a.role.toUpperCase();let _="";if(a.base_url&&!a.base_url.includes("localhost"))try{_=new URL(a.base_url).hostname}catch{}if(!_){let o=d;if(o=o.replace(/^production_/,""),o=o.replace(/^local_/,""),o=o.replace(/^instance_/,""),o.includes("-")){const v=o.split("-");v.length>=5&&(o=v.slice(0,2).join("-"))}o.length>20&&(o=o.substring(0,20)),_=o}return`${u}-${_}`}oe();var f=ua(),h=N(f);{var p=a=>{var d=ca();B(a,d)},y=a=>{var d=la();B(a,d)},i=a=>{var d=Ie(),u=ze(d);xe(u,1,()=>T(r),He,(_,o)=>{var v=da();let C;var g=N(v),W=N(g,!0);x(g);var O=w(g,2),M=N(O,!0);x(O);var U=w(O,2);let E;x(v),le((K,j)=>{C=k(v,1,"mesh-node svelte-10x5b0t",null,C,{online:T(o).is_online,offline:!T(o).is_online}),G(W,K),G(M,j),E=k(U,1,"node-status svelte-10x5b0t",null,E,{online:T(o).is_online})},[()=>l(T(o).role),()=>m(T(o))]),B(_,v)}),B(a,d)};Qe(h,a=>{T(s)?a(p):T(r).length===0?a(y,1):a(i,!1)})}x(f),B(t,f),ce()}var fa=P('<div class="dashboard-layout svelte-2agd5u"><aside class="sidebar svelte-2agd5u"><div class="brand svelte-2agd5u"><span class="brand-text svelte-2agd5u">eckWMS</span></div> <div class="mesh-section svelte-2agd5u"><div class="section-label svelte-2agd5u">Connected Servers:</div> <!></div> <nav class="svelte-2agd5u"><a>Dashboard</a> <a>Inventory</a> <a>Warehouse</a> <a>Shipping</a> <a>RMA Requests</a> <a>Printing</a> <a>Devices</a> <a>Users</a></nav> <div class="user-panel svelte-2agd5u"><div class="user-info svelte-2agd5u"><span class="username svelte-2agd5u"> </span> <span class="role svelte-2agd5u"> </span></div> <button class="logout-btn svelte-2agd5u">Logout</button></div></aside> <main class="content svelte-2agd5u"><!></main> <!></div>');function Ta(t,e){ie(e,!1);const r=()=>Q(se,"$wsStore",c),s=()=>Q(te,"$authStore",c),n=()=>Q(Xe,"$page",c),[c,l]=Ne();we(()=>{const b=te.subscribe(A=>{!A.isLoading&&!A.isAuthenticated&&J(`${S||"/E"}/login`)});return se.connect(),()=>{b()}}),ye(()=>{});function m(){te.logout(),se.close(),J(`${S}/login`)}function f(b){if(!(Date.now()-(b._receivedAt||0)>2e3)){if(b.barcode||b.data&&b.data.barcode){const A=b.barcode||b.data.barcode;h(A);return}b.success&&b.data?I.add("Operation Success","success"):b.type==="ERROR"||b.error?I.add(b.text||b.error||"Error occurred","error"):b.text&&I.add(b.text,"info")}}async function h(b){var A,q,V,H;I.add("Scanning...","info",1e3);try{const L=await fetch("/api/scan",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s().token}`},body:JSON.stringify({barcode:b})});if(!L.ok){const D=await L.json();throw new Error(D.error||"Scan failed")}const $=await L.json();I.add($.message,"success"),$.type==="item"&&((A=$.data)!=null&&A.id)?J(`${S}/dashboard/items/${$.data.id}`):$.type==="box"&&((q=$.data)!=null&&q.id)?(console.log("Box scanned:",$.data),I.add(`Box ${$.data.name||$.data.id} scanned`,"success")):$.type==="place"&&((V=$.data)!=null&&V.id)?J(`${S}/dashboard/warehouse/${$.data.id}`):$.type==="product"&&((H=$.data)!=null&&H.id)?J(`${S}/dashboard/items/${$.data.id}`):$.type==="label"&&console.log("Label scanned:",$.data)}catch(L){console.error("Scan error:",L),I.add(`Error: ${L.message}`,"error")}}Je(()=>r(),()=>{r().lastMessage&&f(r().lastMessage)}),Ge(),oe();var p=fa(),y=N(p),i=w(N(y),2),a=w(N(i),2);va(a,{}),x(i);var d=w(i,2),u=N(d);let _;var o=w(u,2);let v;var C=w(o,2);let g;var W=w(C,2);let O;var M=w(W,2);let U;var E=w(M,2);let K;var j=w(E,2);let de;var ue=w(j,2);let ve;x(d);var fe=w(d,2),Y=N(fe),Z=N(Y),Ee=N(Z,!0);x(Z);var pe=w(Z,2),Te=N(pe,!0);x(pe),x(Y);var ke=w(Y,2);x(fe),x(y);var ee=w(y,2),Oe=N(ee);Ve(Oe,e,"default",{}),x(ee);var Ae=w(ee,2);ia(Ae,{}),x(p),le((b,A,q,V,H,L,$)=>{F(u,"href",`${S??""}/dashboard`),_=k(u,1,"svelte-2agd5u",null,_,{active:n().url.pathname===`${S}/dashboard`||n().url.pathname==="/dashboard"}),F(o,"href",`${S??""}/dashboard/items`),v=k(o,1,"svelte-2agd5u",null,v,b),F(C,"href",`${S??""}/dashboard/warehouse`),g=k(C,1,"svelte-2agd5u",null,g,A),F(W,"href",`${S??""}/dashboard/shipping`),O=k(W,1,"svelte-2agd5u",null,O,q),F(M,"href",`${S??""}/dashboard/rma`),U=k(M,1,"svelte-2agd5u",null,U,V),F(E,"href",`${S??""}/dashboard/print`),K=k(E,1,"svelte-2agd5u",null,K,H),F(j,"href",`${S??""}/dashboard/devices`),de=k(j,1,"svelte-2agd5u",null,de,L),F(ue,"href",`${S??""}/dashboard/users`),ve=k(ue,1,"svelte-2agd5u",null,ve,$),G(Ee,(s(),re(()=>{var D;return((D=s().currentUser)==null?void 0:D.username)||"User"}))),G(Te,(s(),re(()=>{var D;return((D=s().currentUser)==null?void 0:D.role)||"Operator"})))},[()=>({active:n().url.pathname.includes("/items")}),()=>({active:n().url.pathname.includes("/warehouse")}),()=>({active:n().url.pathname.includes("/shipping")}),()=>({active:n().url.pathname.includes("/rma")}),()=>({active:n().url.pathname.includes("/print")}),()=>({active:n().url.pathname.includes("/devices")}),()=>({active:n().url.pathname.includes("/users")})]),Se("click",ke,m),B(t,p),ce(),l()}export{Ta as component};
