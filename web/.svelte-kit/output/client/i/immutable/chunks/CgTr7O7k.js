import{w as u}from"./CN5Z31N9.js";import{b as l}from"./BODtoanW.js";const g=!0,i={isAuthenticated:!1,currentUser:null,token:null,isLoading:!0};function d(){const{subscribe:n,set:r,update:e}=u(i);return{subscribe:n,init:()=>{const a=localStorage.getItem("auth_token");e(a?o=>({...o,isAuthenticated:!0,token:a,isLoading:!1}):o=>({...o,isLoading:!1}))},login:async(a,o)=>{e(t=>({...t,isLoading:!0}));try{const t=await fetch(`${l}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({Email:a,Password:o})});if(!t.ok)throw new Error("Login failed");const s=await t.json();return g&&localStorage.setItem("auth_token",s.tokens.accessToken),e(c=>({...c,isAuthenticated:!0,currentUser:s.user,token:s.tokens.accessToken,isLoading:!1})),{success:!0}}catch(t){return e(s=>({...s,isLoading:!1})),{success:!1,error:t.message}}},logout:()=>{localStorage.removeItem("auth_token"),r({...i,isLoading:!1})}}}const f=d();localStorage.getItem("auth_token")&&f.init();export{f as a};
