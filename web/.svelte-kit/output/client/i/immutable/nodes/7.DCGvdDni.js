import{a as i,f as o,t as ms}from"../chunks/BygaA0WS.js";import{i as _s}from"../chunks/BqIW1Qmb.js";import{z as ps,G as us,B as fs,D as e,c as g,b as a,C as t,F as s,m as E,J as Ca,A as h,H as _a}from"../chunks/CN5Z31N9.js";import{e as D,s as p}from"../chunks/DAV6nA3v.js";import{i as u}from"../chunks/CU63fefz.js";import{s as j,e as za,i as Ea}from"../chunks/DFBiLcyC.js";import{r as pa,s as bs}from"../chunks/BZk0zrkd.js";import{b as ua}from"../chunks/De01lyDX.js";import{s as gs}from"../chunks/Bfc47y5P.js";import{s as ys,a as hs}from"../chunks/DqSeMMib.js";import{p as xs}from"../chunks/CJ_YWpRR.js";import{a as q}from"../chunks/Nceboc1J.js";import{g as Is}from"../chunks/D6cZGLQe.js";import{t as N}from"../chunks/DycCOpGa.js";import{b as Fa}from"../chunks/BODtoanW.js";var ws=o('<button class="btn secondary svelte-7rm230">Cancel</button> <button class="btn primary svelte-7rm230">Save</button>',1),As=o('<button class="btn primary svelte-7rm230">Edit Item</button>'),ks=o('<h1 class="svelte-7rm230"> </h1> <div class="actions svelte-7rm230"><!></div>',1),$s=o('<h1 class="svelte-7rm230">Item Details</h1>'),Cs=o('<div class="loading">Loading details...</div>'),zs=o('<div class="error"> </div>'),Es=o('<input type="text" class="code-input svelte-7rm230"/>'),Fs=o('<div class="value code svelte-7rm230"> </div>'),Ss=o('<input type="text" class="svelte-7rm230"/>'),Bs=o('<div class="value svelte-7rm230"> </div>'),Ps=o('<input type="text" class="code-input svelte-7rm230"/>'),Ds=o('<div class="value code svelte-7rm230"> </div>'),Ls=o('<span class="badge svelte-7rm230">MAIN</span>'),Ms=o('<span class="spinner svelte-7rm230">&#x21bb;</span>'),Rs=o('<div><img alt="Item photo" loading="lazy" class="svelte-7rm230"/> <!> <button class="ai-btn svelte-7rm230" title="AI Analyze"><!></button></div>'),Us=o("<span> </span>"),Vs=o('<div class="tag-row svelte-7rm230"><span> </span> <!></div>'),Ks=o('<p class="svelte-7rm230"><strong>Description:</strong> </p>'),Ns=o('<p class="svelte-7rm230"><strong>OCR:</strong> <code class="svelte-7rm230"> </code></p>'),Gs=o('<span class="pill svelte-7rm230"> </span>'),Hs=o('<div class="tags svelte-7rm230"></div>'),Js=o('<p class="raw svelte-7rm230"><code class="svelte-7rm230"> </code></p>'),Os=o('<div class="analysis-overlay svelte-7rm230"><div class="analysis-header svelte-7rm230"><h4 class="svelte-7rm230">AI Analysis</h4> <button class="close-btn svelte-7rm230">&times;</button></div> <div class="analysis-content svelte-7rm230"><!> <!> <!> <!> <!></div></div>'),Ts=o('<div class="section gallery-section svelte-7rm230"><h3 class="svelte-7rm230"> </h3> <div class="gallery-grid svelte-7rm230"></div> <!></div>'),Ws=o('<div class="detail-grid svelte-7rm230"><div class="section main-info svelte-7rm230"><h3 class="svelte-7rm230">Basic Information</h3> <div class="field svelte-7rm230"><label class="svelte-7rm230">SKU</label> <!></div> <div class="field svelte-7rm230"><label class="svelte-7rm230">Name</label> <!></div> <div class="field svelte-7rm230"><label class="svelte-7rm230">Barcode</label> <!></div> <div class="field svelte-7rm230"><label class="svelte-7rm230">Type</label> <div class="value svelte-7rm230"> </div></div></div> <div class="section stats svelte-7rm230"><h3 class="svelte-7rm230">Inventory Status</h3> <div class="stat-box svelte-7rm230"><span class="label svelte-7rm230">List Price</span> <span class="val svelte-7rm230"> </span></div> <div class="stat-box svelte-7rm230"><span class="label svelte-7rm230">Cost Price</span> <span class="val svelte-7rm230"> </span></div> <div class="stat-box svelte-7rm230"><span class="label svelte-7rm230">Weight</span> <span class="val svelte-7rm230"> </span></div> <div class="stat-box svelte-7rm230"><span class="label svelte-7rm230">Volume</span> <span class="val svelte-7rm230"> </span></div> <div class="stat-box svelte-7rm230"><span class="label svelte-7rm230">Status</span> <span> </span></div></div> <!></div>'),js=o('<div class="detail-page svelte-7rm230"><div class="header svelte-7rm230"><button class="back-btn svelte-7rm230">&larr; Back</button> <div class="title-row svelte-7rm230"><!></div></div> <!></div>');function de(Sa,Ba){ps(Ba,!1);const Pa=()=>hs(xs,"$page",Da),[Da,La]=ys();let n=E(null),G=E([]),fa=E(!0),k=E(!1),Q=E(null),x=E({}),H=E(null),_=E(null);us(async()=>{await Ma()});async function Ma(){try{g(n,await q.get(`/api/items/${Pa().params.id}`)),g(x,{...a(n)}),await Ra()}catch(v){g(Q,v.message)}finally{g(fa,!1)}}async function Ra(){if(!a(n))return;const v=a(n).barcode;if(v)try{g(G,await q.get(`/api/attachments/product/${encodeURIComponent(v)}`))}catch(d){console.warn("Failed to load attachments",d)}}function ba(){a(k)&&g(x,{...a(n)}),g(k,!a(k))}async function Ua(){try{const v=await q.put(`/api/items/${a(n).id}`,a(x));g(n,v),g(x,{...a(n)}),g(k,!1),N.add("Item updated successfully","success")}catch(v){N.add(v.message,"error")}}function Va(){Is(`${Fa}/dashboard/items`)}function Ka(v){return`${Fa}/api/files/${v}`}async function Na(v){var d,I,$;g(H,v),g(_,null);try{const w=await q.post("/api/ai/analyze-image",{file_id:v});w.success&&(g(_,{fileId:v,data:w.analysis}),N.add("Analysis complete","success"))}catch(w){(d=w.message)!=null&&d.includes("503")||(I=w.message)!=null&&I.includes("unavailable")||($=w.message)!=null&&$.includes("Service")?N.add("AI Analysis unavailable (Check API Key or Config)","error",5e3):N.add(w.message||"Analysis failed","error")}finally{g(H,null)}}_s();var X=js(),Y=e(X),ga=e(Y),ya=t(ga,2),Ga=e(ya);{var Ha=v=>{var d=ks(),I=Ca(d),$=e(I);s(I);var w=t(I,2),Z=e(w);{var aa=C=>{var F=ws(),J=Ca(F),M=t(J,2);D("click",J,ba),D("click",M,Ua),i(C,F)},L=C=>{var F=As();D("click",F,ba),i(C,F)};u(Z,C=>{a(k)?C(aa):C(L,!1)})}s(w),h(()=>p($,`${a(k)?"Editing: ":""}${a(n).name??""}`)),i(v,d)},Ja=v=>{var d=$s();i(v,d)};u(Ga,v=>{a(n)?v(Ha):v(Ja,!1)})}s(ya),s(Y);var Oa=t(Y,2);{var Ta=v=>{var d=Cs();i(v,d)},Wa=v=>{var d=zs(),I=e(d);s(d),h(()=>p(I,`Error: ${a(Q)??""}`)),i(v,d)},ja=v=>{var d=Ws(),I=e(d),$=t(e(I),2),w=t(e($),2);{var Z=r=>{var l=Es();pa(l),ua(l,()=>a(x).default_code,f=>_a(x,a(x).default_code=f)),i(r,l)},aa=r=>{var l=Fs(),f=e(l,!0);s(l),h(()=>p(f,a(n).default_code||"-")),i(r,l)};u(w,r=>{a(k)?r(Z):r(aa,!1)})}s($);var L=t($,2),C=t(e(L),2);{var F=r=>{var l=Ss();pa(l),ua(l,()=>a(x).name,f=>_a(x,a(x).name=f)),i(r,l)},J=r=>{var l=Bs(),f=e(l,!0);s(l),h(()=>p(f,a(n).name)),i(r,l)};u(C,r=>{a(k)?r(F):r(J,!1)})}s(L);var M=t(L,2),qa=t(e(M),2);{var Qa=r=>{var l=Ps();pa(l),ua(l,()=>a(x).barcode,f=>_a(x,a(x).barcode=f)),i(r,l)},Xa=r=>{var l=Ds(),f=e(l,!0);s(l),h(()=>p(f,a(n).barcode||"-")),i(r,l)};u(qa,r=>{a(k)?r(Qa):r(Xa,!1)})}s(M);var ha=t(M,2),xa=t(e(ha),2),Ya=e(xa,!0);s(xa),s(ha),s(I);var sa=t(I,2),ea=t(e(sa),2),Ia=t(e(ea),2),Za=e(Ia);s(Ia),s(ea);var ta=t(ea,2),wa=t(e(ta),2),as=e(wa);s(wa),s(ta);var ra=t(ta,2),Aa=t(e(ra),2),ss=e(Aa);s(Aa),s(ra);var va=t(ra,2),ka=t(e(va),2),es=e(ka);s(ka),s(va);var $a=t(va,2),la=t(e($a),2),ts=e(la,!0);s(la),s($a),s(sa);var rs=t(sa,2);{var vs=r=>{var l=Ts(),f=e(l),ls=e(f);s(f);var ia=t(f,2);za(ia,5,()=>a(G),Ea,(R,A)=>{var z=Rs();let O;var U=e(z),V=t(U,2);{var oa=b=>{var B=Ls();i(b,B)};u(V,b=>{a(A).is_main&&b(oa)})}var S=t(V,2),na=e(S);{var T=b=>{var B=Ms();i(b,B)},da=b=>{var B=ms("✨");i(b,B)};u(na,b=>{a(H)===a(A).file_id?b(T):b(da,!1)})}s(S),s(z),h(b=>{O=j(z,1,"photo-card svelte-7rm230",null,O,{main:a(A).is_main}),bs(U,"src",b),S.disabled=a(H)===a(A).file_id},[()=>Ka(a(A).file_id)]),D("click",S,gs(()=>Na(a(A).file_id))),i(R,z)}),s(ia);var is=t(ia,2);{var os=R=>{var A=Os(),z=e(A),O=t(e(z),2);s(z);var U=t(z,2),V=e(U);{var oa=c=>{var m=Vs(),y=e(m),P=e(y,!0);s(y);var K=t(y,2);{var ca=ma=>{var W=Us(),cs=e(W);s(W),h(()=>{j(W,1,`tag ${a(_).data.labels_visible?"good":"damaged"}`,"svelte-7rm230"),p(cs,`Labels: ${a(_).data.labels_visible?"Visible":"Missing"}`)}),i(ma,W)};u(K,ma=>{a(_).data.labels_visible!==void 0&&ma(ca)})}s(m),h(()=>{j(y,1,`tag condition ${a(_).data.condition??""}`,"svelte-7rm230"),p(P,a(_).data.condition)}),i(c,m)};u(V,c=>{a(_).data.condition&&c(oa)})}var S=t(V,2);{var na=c=>{var m=Ks(),y=t(e(m));s(m),h(()=>p(y,` ${a(_).data.description??""}`)),i(c,m)};u(S,c=>{a(_).data.description&&c(na)})}var T=t(S,2);{var da=c=>{var m=Ns(),y=t(e(m),2),P=e(y,!0);s(y),s(m),h(()=>p(P,a(_).data.ocr_text)),i(c,m)};u(T,c=>{a(_).data.ocr_text&&c(da)})}var b=t(T,2);{var B=c=>{var m=Hs();za(m,5,()=>a(_).data.tags,Ea,(y,P)=>{var K=Gs(),ca=e(K,!0);s(K),h(()=>p(ca,a(P))),i(y,K)}),s(m),i(c,m)};u(b,c=>{a(_).data.tags&&c(B)})}var ns=t(b,2);{var ds=c=>{var m=Js(),y=e(m),P=e(y,!0);s(y),s(m),h(()=>p(P,a(_).data.raw_analysis)),i(c,m)};u(ns,c=>{a(_).data.raw_analysis&&c(ds)})}s(U),s(A),D("click",O,()=>g(_,null)),i(R,A)};u(is,R=>{a(_)&&R(os)})}s(l),h(()=>p(ls,`Visual Evidence (${a(G).length??""})`)),i(r,l)};u(rs,r=>{a(G).length>0&&r(vs)})}s(d),h((r,l)=>{p(Ya,a(n).type||"-"),p(Za,`$${r??""}`),p(as,`$${l??""}`),p(ss,`${(a(n).weight||0)??""} kg`),p(es,`${(a(n).volume||0)??""} m³`),j(la,1,`val ${a(n).active?"active":"inactive"}`,"svelte-7rm230"),p(ts,a(n).active?"Active":"Inactive")},[()=>{var r;return((r=a(n).list_price)==null?void 0:r.toFixed(2))||"0.00"},()=>{var r;return((r=a(n).standard_price)==null?void 0:r.toFixed(2))||"0.00"}]),i(v,d)};u(Oa,v=>{a(fa)?v(Ta):a(Q)?v(Wa,1):a(n)&&v(ja,2)})}s(X),D("click",ga,Va),i(Sa,X),fs(),La()}export{de as component};
