import{a as m,f as _}from"../chunks/BygaA0WS.js";import{i as ze}from"../chunks/BqIW1Qmb.js";import{z as Je,G as Oe,B as Ue,D as s,c as n,b as t,C as o,F as i,m as R,J as _e,E as Ve,A as X,H as E}from"../chunks/CN5Z31N9.js";import{e as $,s as I}from"../chunks/DAV6nA3v.js";import{i as L}from"../chunks/CU63fefz.js";import{s as ge,e as Ze,i as Ke}from"../chunks/DFBiLcyC.js";import{s as Qe,r as Q}from"../chunks/BZk0zrkd.js";import{s as be}from"../chunks/DZHojTuh.js";import{b as ee}from"../chunks/De01lyDX.js";import{b as et}from"../chunks/DwKrkxP9.js";import{a as tt,s as at}from"../chunks/DqSeMMib.js";import{p as st}from"../chunks/CJ_YWpRR.js";import{a as Y}from"../chunks/Nceboc1J.js";import{g as it}from"../chunks/D6cZGLQe.js";import{t as y}from"../chunks/DycCOpGa.js";var rt=_('<h1 class="svelte-174jrif"> <span class="blueprint-label svelte-174jrif">Blueprint</span></h1> <div class="actions"><button> </button></div>',1),ot=_('<h1 class="svelte-174jrif">Warehouse Blueprint</h1>'),lt=_('<div class="loading">Loading blueprint...</div>'),nt=_('<div class="error"> </div>'),vt=_('<div class="edit-form"><div class="form-group svelte-174jrif"><label class="svelte-174jrif">Name</label> <input type="text" class="svelte-174jrif"/></div> <div class="form-group svelte-174jrif"><label class="svelte-174jrif">Columns</label> <input type="number" class="svelte-174jrif"/></div> <div class="form-group svelte-174jrif"><label class="svelte-174jrif">Rows</label> <input type="number" class="svelte-174jrif"/></div> <div class="form-group svelte-174jrif"><label class="svelte-174jrif">Rotation (°)</label> <select class="svelte-174jrif"><option>0°</option><option>90°</option><option>180°</option><option>270°</option></select></div> <div class="form-actions svelte-174jrif"><button class="btn secondary svelte-174jrif">Delete</button> <button class="btn primary svelte-174jrif">Update</button></div></div>'),dt=_('<div class="hint svelte-174jrif">Select a rack to edit properties.</div>'),ct=_('<div class="editor-sidebar svelte-174jrif"><h3 class="svelte-174jrif">Rack Properties</h3> <div class="sidebar-actions"><button class="btn primary full-width svelte-174jrif">+ Add Rack</button></div> <!></div>'),ut=_('<span class="rack-info svelte-174jrif"> </span>'),ft=_('<div><div class="rack-label svelte-174jrif"><span class="rack-name svelte-174jrif"> </span> <!></div></div>'),pt=_(`<div class="empty-canvas svelte-174jrif">No racks. Click 'Edit Layout' to add one.</div>`),mt=_('<div class="layout-container svelte-174jrif"><!>  <div class="viewport svelte-174jrif"><div class="canvas svelte-174jrif"><!> <!></div></div></div> <div class="controls svelte-174jrif"><div class="legend svelte-174jrif"><div class="legend-item svelte-174jrif"><span class="box rack-box svelte-174jrif"></span> Rack</div> <div class="legend-item svelte-174jrif"><span class="box selected-box svelte-174jrif"></span> Selected</div></div> <div class="info svelte-174jrif"> </div></div>',1),_t=_('<div class="blueprint-page svelte-174jrif"><div class="header svelte-174jrif"><button class="back-btn svelte-174jrif">← Back</button> <div class="title-row svelte-174jrif"><!></div></div> <!></div>');function Ct(he,we){Je(we,!1);const je=()=>tt(st,"$page",xe),[xe,ye]=at();let te=je().params.id,S=R(null),A=R(!0),F=R(null),r=R([]),j=R(!1),f=R(null),N=!1,H={x:0,y:0},B=null,v=R({name:"",columns:1,rows:1,rotation:0});const ae=50;Oe(async()=>{await ke()});async function ke(){try{n(A,!0),n(S,await Y.get(`/api/warehouse/${te}`)),n(r,t(S).racks||[])}catch(e){n(F,e.message),y.add("Error loading warehouse","error")}finally{n(A,!1)}}function Re(){it("/dashboard/warehouse")}function Ee(){n(j,!t(j)),n(f,null)}function $e(e){const a=e.visualWidth>0?e.visualWidth:e.columns*ae,l=e.visualHeight>0?e.visualHeight:e.rows*ae;return`
            left: ${e.posX||0}px;
            top: ${e.posY||0}px;
            width: ${a}px;
            height: ${l}px;
            transform: rotate(${e.rotation||0}deg);
        `}function De(e,a){if(!t(j))return;e.stopPropagation(),N=!0,B=a.id,re(a);const c=e.currentTarget.getBoundingClientRect();H={x:e.clientX-c.left,y:e.clientY-c.top},window.addEventListener("mousemove",se),window.addEventListener("mouseup",ie)}function se(e){if(!N||!B)return;const l=document.querySelector(".canvas").getBoundingClientRect();let c=e.clientX-l.left-H.x,b=e.clientY-l.top-H.y;c=Math.round(c/10)*10,b=Math.round(b/10)*10,c=Math.max(0,c),b=Math.max(0,b);const p=t(r).findIndex(D=>D.id===B);p!==-1&&(E(r,t(r)[p].posX=c),E(r,t(r)[p].posY=b),n(r,[...t(r)]))}async function ie(){if(!N)return;const e=t(r).find(a=>a.id===B);e&&await Ie(e),N=!1,B=null,window.removeEventListener("mousemove",se),window.removeEventListener("mouseup",ie)}async function Ie(e){try{await Y.put(`/api/warehouse/racks/${e.id}`,{posX:e.posX,posY:e.posY})}catch{y.add("Failed to save position","error")}}function re(e){n(f,e),n(v,{name:e.name,columns:e.columns,rows:e.rows,rotation:e.rotation||0})}function Le(){n(f,null)}async function Be(){if(t(f))try{const e=await Y.put(`/api/warehouse/racks/${t(f).id}`,t(v)),a=t(r).findIndex(l=>l.id===t(f).id);a!==-1&&(E(r,t(r)[a]={...t(r)[a],...e}),n(r,[...t(r)])),y.add("Rack updated","success")}catch(e){y.add(e.message,"error")}}async function Ce(){const e=prompt("New Rack Name:");if(e)try{const a=await Y.post("/api/warehouse/racks",{warehouseId:parseInt(te),name:e,columns:1,rows:1,posX:50,posY:50,startIndex:0});n(r,[...t(r),a]),re(a),y.add("Rack created","success")}catch(a){y.add(a.message,"error")}}async function Me(){if(!(!t(f)||!confirm("Delete this rack?")))try{await Y.delete(`/api/warehouse/racks/${t(f).id}`),n(r,t(r).filter(e=>e.id!==t(f).id)),n(f,null),y.add("Rack deleted","success")}catch(e){y.add(e.message,"error")}}function Xe(e){e.target.classList.contains("canvas")&&Le()}ze();var P=_t(),G=s(P),oe=s(G),le=o(oe,2),Ye=s(le);{var Se=e=>{var a=rt(),l=_e(a),c=s(l);Ve(),i(l);var b=o(l,2),p=s(b),D=s(p,!0);i(p),i(b),X(()=>{I(c,`${t(S).name??""} `),ge(p,1,`btn ${t(j)?"active":""}`,"svelte-174jrif"),I(D,t(j)?"Done Editing":"Edit Layout")}),$("click",p,Ee),m(e,a)},Ne=e=>{var a=ot();m(e,a)};L(Ye,e=>{t(S)?e(Se):e(Ne,!1)})}i(le),i(G);var We=o(G,2);{var Ae=e=>{var a=lt();m(e,a)},Fe=e=>{var a=nt(),l=s(a,!0);i(a),X(()=>I(l,t(F))),m(e,a)},He=e=>{var a=mt(),l=_e(a),c=s(l);{var b=w=>{var d=ct(),g=o(s(d),2),C=s(g);i(g);var M=o(g,2);{var T=x=>{var u=vt(),h=s(u),W=o(s(h),2);Q(W),i(h);var z=o(h,2),ce=o(s(z),2);Q(ce),i(z);var J=o(z,2),ue=o(s(J),2);Q(ue),i(J);var O=o(J,2),U=o(s(O),2),V=s(U);V.value=V.__value=0;var Z=o(V);Z.value=Z.__value=90;var K=o(Z);K.value=K.__value=180;var fe=o(K);fe.value=fe.__value=270,i(U),i(O);var pe=o(O,2),me=s(pe),qe=o(me,2);i(pe),i(u),ee(W,()=>t(v).name,k=>E(v,t(v).name=k)),ee(ce,()=>t(v).columns,k=>E(v,t(v).columns=k)),ee(ue,()=>t(v).rows,k=>E(v,t(v).rows=k)),et(U,()=>t(v).rotation,k=>E(v,t(v).rotation=k)),$("click",me,Me),$("click",qe,Be),m(x,u)},q=x=>{var u=dt();m(x,u)};L(M,x=>{t(f)?x(T):x(q,!1)})}i(d),$("click",C,Ce),m(w,d)};L(c,w=>{t(j)&&w(b)})}var p=o(c,2),D=s(p),ne=s(D);Ze(ne,1,()=>t(r),Ke,(w,d)=>{var g=ft(),C=s(g),M=s(C),T=s(M,!0);i(M);var q=o(M,2);{var x=u=>{var h=ut(),W=s(h);i(h),X(()=>I(W,`${t(d).columns??""}×${t(d).rows??""}`)),m(u,h)};L(q,u=>{t(j)||u(x)})}i(C),i(g),X(u=>{var h;ge(g,1,`rack ${((h=t(f))==null?void 0:h.id)===t(d).id?"selected":""}`,"svelte-174jrif"),be(g,u),Qe(g,"title",t(d).name),be(C,`transform: rotate(-${(t(d).rotation||0)??""}deg);`),I(T,t(d).name)},[()=>$e(t(d))]),$("mousedown",g,u=>De(u,t(d))),m(w,g)});var Pe=o(ne,2);{var Ge=w=>{var d=pt();m(w,d)};L(Pe,w=>{t(r).length===0&&w(Ge)})}i(D),i(p),i(l);var ve=o(l,2),de=o(s(ve),2),Te=s(de);i(de),i(ve),X(()=>I(Te,`${t(r).length??""} racks | ${t(j)?"Edit Mode Active":"View Mode"}`)),$("click",p,Xe),m(e,a)};L(We,e=>{t(A)?e(Ae):t(F)?e(Fe,1):e(He,!1)})}i(P),$("click",oe,Re),m(he,P),Ue(),ye()}export{Ct as component};
